<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>main function for parameter estimation — estim_param • CroptimizR</title><!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png"><link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png"><link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png"><link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png"><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="main function for parameter estimation — estim_param"><meta property="og:description" content="main function for parameter estimation"><meta property="og:image" content="/logo.png"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">CroptimizR</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.6.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../articles/CroptimizR.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu"><li>
      <a href="../articles/Available_parameter_estimation_algorithms.html">Available parameter estimation algorithms in CroptimizR</a>
    </li>
    <li>
      <a href="../articles/Designing_a_model_wrapper.html">Guidelines for implementing a crop model R wrapper for CroptimizR</a>
    </li>
    <li>
      <a href="../articles/Parameter_estimation_simple_case.html">Parameter estimation with the Stics crop Model: a simple case</a>
    </li>
    <li>
      <a href="../articles/AgMIP_Calibration_Phenology_protocol.html">Estimating phenology following AgMIP-calibration phase III protocol</a>
    </li>
    <li>
      <a href="../articles/Parameter_estimation_Specific_and_Varietal.html">Parameter estimation with the Stics crop Model: a case with specific and varietal parameters</a>
    </li>
    <li>
      <a href="../articles/ApsimX_parameter_estimation_simple_case.html">Parameter estimation with the ApsimX crop Model: a simple case</a>
    </li>
    <li>
      <a href="../articles/Parameter_estimation_DREAM.html">Parameter estimation with the DREAM-zs algorithm</a>
    </li>
  </ul></li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/SticsRPacks/CroptimizR/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>main function for parameter estimation</h1>
    <small class="dont-index">Source: <a href="https://github.com/SticsRPacks/CroptimizR/blob/HEAD/R/estim_param.R" class="external-link"><code>R/estim_param.R</code></a></small>
    <div class="hidden name"><code>estim_param.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>main function for parameter estimation</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">estim_param</span><span class="op">(</span></span>
<span>  <span class="va">obs_list</span>,</span>
<span>  crit_function <span class="op">=</span> <span class="va">crit_log_cwss</span>,</span>
<span>  <span class="va">model_function</span>,</span>
<span>  model_options <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  optim_method <span class="op">=</span> <span class="st">"nloptr.simplex"</span>,</span>
<span>  optim_options <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  <span class="va">param_info</span>,</span>
<span>  forced_param_values <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  candidate_param <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  transform_var <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  transform_obs <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  transform_sim <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  satisfy_par_const <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  var <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  info_level <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  info_crit_func <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu">CroptimizR</span><span class="fu">::</span><span class="va"><a href="BIC.html">BIC</a></span>, <span class="fu">CroptimizR</span><span class="fu">::</span><span class="va"><a href="AICc.html">AICc</a></span>, <span class="fu">CroptimizR</span><span class="fu">::</span><span class="va"><a href="AIC.html">AIC</a></span><span class="op">)</span>,</span>
<span>  weight <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  var_names <span class="op">=</span> <span class="fu">lifecycle</span><span class="fu">::</span><span class="fu"><a href="https://lifecycle.r-lib.org/reference/deprecated.html" class="external-link">deprecated</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>
    <dl><dt>obs_list</dt>
<dd><p>List of observed values to use for parameter estimation.
A <code>named list</code> (names = situations names) of data.frame containing
one column named Date with the dates (Date or POSIXct format) of the different observations
and one column per observed variables with either the measured values or NA, if
the variable is not observed at the given date.
See details section for more information on the list of observations actually
used during the parameter estimation process.</p></dd>


<dt>crit_function</dt>
<dd><p>Function implementing the criterion to optimize
(optional, see default value in the function signature). See
<a href="https://sticsrpacks.github.io/CroptimizR/reference/ls_criteria.html" class="external-link">here</a>
for more details about the list of proposed criteria.</p></dd>


<dt>model_function</dt>
<dd><p>Crop Model wrapper function to use.</p></dd>


<dt>model_options</dt>
<dd><p>List of options for the Crop Model wrapper (see help of
the Crop Model wrapper function used).</p></dd>


<dt>optim_method</dt>
<dd><p>Name of the parameter estimation method to use (optional,
see default value in the function signature). For the moment, can be "simplex"
or "dreamzs". See <a href="https://sticsrpacks.github.io/CroptimizR/articles/Available_parameter_estimation_algorithms.html" class="external-link">here</a>
for a brief description and references on the available methods.</p></dd>


<dt>optim_options</dt>
<dd><p>List of options of the parameter estimation method, containing:</p><ul><li><p><code>out_dir</code> Directory path where to write the optimization results (optional, default to <code><a href="https://rdrr.io/r/base/getwd.html" class="external-link">getwd()</a></code>)</p></li>
<li><p><code>ranseed</code> Set random seed so that each execution of estim_param give the same
results when using the same seed. If you want randomization, set it to NULL,
otherwise set it to a number of your choice (e.g. 1234) (optional, default to NULL, which means random seed)</p></li>
<li><p>specific options depending on the method used. Click on the links to see examples with the <a href="https://sticsrpacks.github.io/CroptimizR/articles/Parameter_estimation_simple_case.html" class="external-link">simplex</a>
and <a href="https://sticsrpacks.github.io/CroptimizR/articles/Parameter_estimation_DREAM.html" class="external-link">DreamZS</a> methods.</p></li>
<li><p><code>path_results</code> <a href="https://lifecycle.r-lib.org/articles/stages.html#deprecated" class="external-link"><img src="figures/lifecycle-deprecated.svg" alt="[Deprecated]"></a> <code>path_results</code> is no longer supported, use <code>out_dir</code> instead.</p></li>
</ul></dd>


<dt>param_info</dt>
<dd><p>Information on the parameters to estimate.
Either
a list containing:</p><ul><li><p><code>ub</code> and <code>lb</code>, named vectors of upper and lower bounds (-Inf and Inf can be used if init_values is provided),</p></li>
<li><p><code>init_values</code>, a data.frame containing initial
values to test for the parameters (optional, if not provided, or if less values
than number of repetitions of the minimization are provided, the, or part
of the, initial values will be randomly generated using LHS sampling within
parameter bounds).</p></li>
</ul><p>or a named list containing for each parameter:</p><ul><li><p><code>sit_list</code>, list the groups of situations for which the current estimated
parameter must take different values (see <a href="https://sticsrpacks.github.io/CroptimizR/articles/Parameter_estimation_Specific_and_Varietal.html" class="external-link">here</a>
for an example),</p></li>
<li><p><code>ub</code> and <code>lb</code>, vectors of upper and lower bounds (one value per group),</p></li>
<li><p><code>init_values</code>, the list of initial values per group  (data.frame, one column per group, optional).</p></li>
</ul></dd>


<dt>forced_param_values</dt>
<dd><p>Named vector or list, must contain the values (or
arithmetic expression, see details section) for the model parameters to force. The corresponding
values will be transferred to the model wrapper through its param_values argument
during the estimation process.
Should not include values for estimated parameters (i.e. parameters defined in
<code>param_info</code> argument), except if they are listed as candidate parameters (see
argument <code>candidate_param</code>).</p></dd>


<dt>candidate_param</dt>
<dd><p>Names of the parameters, among those defined in the argument param_info,
that must only be considered as candidate for parameter estimation (see details section).</p></dd>


<dt>transform_var</dt>
<dd><p>Named vector of functions to apply both on simulated and
observed variables. <code>transform_var=c(var1=log, var2=sqrt)</code> will for example
apply log-transformation on simulated and observed values of variable var1,
and square-root transformation on values of variable var2.</p></dd>


<dt>transform_obs</dt>
<dd><p>User function for transforming observations before each criterion
evaluation (optional), see details section for more information.</p></dd>


<dt>transform_sim</dt>
<dd><p>User function for transforming simulations before each criterion
evaluation  (optional), see details section for more information.</p></dd>


<dt>satisfy_par_const</dt>
<dd><p>User function for including constraints on estimated
parameters (optional), see details section for more information.</p></dd>


<dt>var</dt>
<dd><p>(optional) List of variables for which the model wrapper must return
results.
By default the wrapper is asked to simulate only the observed variables. However,
it may be useful to simulate also other variables, typically when transform_sim
and/or transform_obs functions are used. Note however that it is
active only if the model_function used handles this argument.
If it is the case, and if the var argument is provided, then the list of observations
used will be restricted to the list of variables given in the var argument,
plus the ones possibly computed by the transform_sim function.</p></dd>


<dt>info_level</dt>
<dd><p>(optional) Integer that controls the level of information returned and stored
by estim_param (in addition to the results automatically provided that depends on the method used).
Higher code give more details.</p><ul><li><p><code>0</code> to add nothing,</p></li>
<li><p><code>1</code> to add criterion and parameters values, and constraint if satisfy_par_const is provided, for each evaluation
(element params_and_crit in the returned list),</p></li>
<li><p><code>2</code> to add model results, after transformation if transform_sim is provided, and after intersection with observations,
i.e. as used to compute the criterion for each evaluation (element sim_intersect in the returned list),</p></li>
<li><p><code>3</code> to add observations, after transformation if transform_obs is provided, and after intersection with simulations,
i.e. as used to compute the criterion for each evaluation (element obs_intersect in the returned list),</p></li>
<li><p><code>4</code> to add all model wrapper results for each evaluation, and all transformations if transform_sim is provided.
(elements sim and sim_transformed in the returned list).</p></li>
</ul></dd>


<dt>info_crit_func</dt>
<dd><p>Function (or list of functions) to compute information criteria.
(optional, see default value in the function signature and <a href="https://sticsrpacks.github.io/CroptimizR/reference/information_criteria.html" class="external-link">here</a>
for more details about the list of proposed information criteria.).
Values of the information criteria will be stored in the returned list.
In case parameter selection is activated (i.e. if the argument candidate_param
is defined (see details section)), the first information criterion given will be used.
ONLY AVAILABLE FOR THE MOMENT FOR crit_function==crit_ols.</p></dd>


<dt>weight</dt>
<dd><p>Weights to use in the criterion to optimize. A function that takes in input a vector
of observed values and the name of the corresponding variable and that must return either a single value
for the weights for the given variable or a vector of values of length the length of the vector of observed values given in input.</p></dd>


<dt>var_names</dt>
<dd><p><a href="https://lifecycle.r-lib.org/articles/stages.html#deprecated" class="external-link"><img src="figures/lifecycle-deprecated.svg" alt="[Deprecated]"></a> <code>var_names</code> is no
longer supported, use <code>var</code> instead.</p></dd>

</dl></div>
    <div id="value">
    <h2>Value</h2>
    

<p>prints, graphs and a list containing the results of the parameter estimation,
which content depends on the method used and on the values of the <code>info_level</code> argument.
All results are saved in the folder <code>optim_options$out_dir</code>.</p>
    </div>
    <div id="details">
    <h2>Details</h2>
    <p>In CroptimizR, parameter estimation is based on the comparison between the values
of the observed and simulated variables at corresponding dates. Only the situations,
variables and dates common to both observations (provided in <code>obs_list</code> argument),
and simulations returned by the wrapper used, will be taken into account in
the parameter estimation process.
In case where the value of an observed variable is NA for a given situation and
date, it will not be taken into account. In case where the value of a simulated
variable is NA (or Inf) for a given situation and date for which there is an
observation, the optimized criterion will take the NA value, which may stop the
process, and the user will be warned.</p>
<p>If the candidate_param argument is given, a parameter selection procedure following
the AgMIP calibration phaseIII protocol will be performed:
The candidate parameters are added one by one (in the given order) to the parameters
that MUST be estimated (i.e. the one defined in param_info but not in candidate_param).
Each time a new candidate is added:</p><ul><li><p>the parameter estimation is performed and an information criterion is computed (see argument info_crit_func)</p></li>
<li><p>if the information criterion is inferior to all the ones obtained before,
then the current candidate parameter is added to the list of parameters to estimate</p></li>
</ul><p>The result includes a summary of all the steps (data.frame param_selection_steps).</p>
<p>The optional argument <code>transform_obs</code> must be a function with 4 arguments:</p><ul><li><p>model_results: the list of simulated results returned by the mode_wrapper used</p></li>
<li><p>obs_list: the list of observations as given to estim_param function</p></li>
<li><p>param_values: a named vector containing the current parameters values proposed
by the estimation algorithm</p></li>
<li><p>model_options: the list of model options as given to estim_param function</p></li>
</ul><p>It must return a list of observations (same format as <code>obs_list</code> argument) that
will be used to compute the criterion to optimize.</p>
<p>The optional argument <code>transform_sim</code> must be a function with 4 arguments:</p><ul><li><p>model_results: the list of simulated results returned by the mode_wrapper used</p></li>
<li><p>obs_list: the list of observations as given to estim_param function</p></li>
<li><p>param_values: a named vector containing the current parameters values proposed
by the estimation algorithm</p></li>
<li><p>model_options: the list of model options as given to estim_param function</p></li>
</ul><p>It must return a list of simulated results (same format as this returned by the model wrapper used)
that will be used to compute the criterion to optimize.</p>
<p>The optional argument <code>satisfy_par_const</code> must be a function with 2 arguments:</p><ul><li><p>param_values: a named vector containing the current parameters values proposed
by the estimation algorithm</p></li>
<li><p>model_options: the list of model options as given to estim_param function</p></li>
</ul><p>It must return a logical indicating if the parameters values satisfies the constraints
(freely defined by the user in the function body) or not.</p>
<p>The optional argument <code>forced_param_values</code> may contain arithmetic expressions to
automatically compute the values of some parameters in function of the values of
parameters that are estimated (equality constraints). For that, <code>forced_param_values</code>
must be a named list. Arithmetic expressions must be R expressions given under the
shape of character strings. For example:</p>
<p>forced_param_values = list(p1=5, p2=7, p3="5*p5+p6")</p>
<p>will pass to the model wrapper the value 5 for parameter p1, 7 for parameter p2,
and will dynamically compute the value of p3 in function of the values of parameters
p5 and p6 iteratively provided by the parameter estimation algorithm. In this example,
the parameters p5 and p6 must thus be part of the list of parameters to estimate, i.e.
described in the <code>param_info</code> argument.</p>
    </div>
    <div id="see-also">
    <h2>See also</h2>
    <div class="dont-index"><p>For more details and examples, see the different vignettes in
<a href="https://sticsrpacks.github.io/CroptimizR/" class="external-link">CroptimizR website</a></p></div>
    </div>

  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Samuel Buis, Patrice Lecharpentier, Remi Vezy, Michel Giner.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer></div>

  


  

  </body></html>

