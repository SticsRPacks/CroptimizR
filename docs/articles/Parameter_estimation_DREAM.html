<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Parameter estimation with the DREAM-zs algorithm • CroptimizR</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Parameter estimation with the DREAM-zs algorithm">
<meta property="og:description" content="CroptimizR">
<meta property="og:image" content="/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">CroptimizR</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.3.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/ApsimX_parameter_estimation_simple_case.html">Parameter estimation with the ApsimX crop Model: a simple case</a>
    </li>
    <li>
      <a href="../articles/Available_parameter_estimation_algorithms.html">Available parameter estimation algorithms in CroptimizR</a>
    </li>
    <li>
      <a href="../articles/Designing_a_model_wrapper.html">Guidelines for implementing a crop model R wrapper for CroptimizR</a>
    </li>
    <li>
      <a href="../articles/Parameter_estimation_DREAM.html">Parameter estimation with the DREAM-zs algorithm</a>
    </li>
    <li>
      <a href="../articles/Parameter_estimation_simple_case.html">Parameter estimation with the Stics crop Model: a simple case</a>
    </li>
    <li>
      <a href="../articles/Parameter_estimation_Specific_and_Varietal.html">Parameter estimation with the Stics crop Model: a case with specific and varietal parameters</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/SticsRPacks/CroptimizR/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="Parameter_estimation_DREAM_files/header-attrs-2.7/header-attrs.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Parameter estimation with the DREAM-zs algorithm</h1>
                        <h4 class="author">Samuel Buis</h4>
                        
            <h4 class="date">2021-06-10</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/SticsRPacks/CroptimizR/blob/master/vignettes/Parameter_estimation_DREAM.Rmd"><code>vignettes/Parameter_estimation_DREAM.Rmd</code></a></small>
      <div class="hidden name"><code>Parameter_estimation_DREAM.Rmd</code></div>

    </div>

    
    
<div id="study-case" class="section level2">
<h2 class="hasAnchor">
<a href="#study-case" class="anchor"></a>Study Case</h2>
<p>This document presents an example of use of the DREAM-zs algorithm with the Stics crop model.</p>
<p>The study case is the same as the specific and varietal parameters estimation presented in this <a href="https://sticsrpacks.github.io/CroptimizR/articles/Parameter_estimation_Specific_and_Varietal.html">vignette</a>.</p>
</div>
<div id="initialisation-step" class="section level2">
<h2 class="hasAnchor">
<a href="#initialisation-step" class="anchor"></a>Initialisation step</h2>
<p>This part is not shown here, it is the same as this of the <a href="https://sticsrpacks.github.io/CroptimizR/articles/Parameter_estimation_simple_case.html">introductory example</a>.</p>
</div>
<div id="read-and-select-the-corresponding-observations" class="section level2">
<h2 class="hasAnchor">
<a href="#read-and-select-the-corresponding-observations" class="anchor"></a>Read and select the corresponding observations</h2>
<p>This part is not shown here, it is the same as this of the <a href="https://sticsrpacks.github.io/CroptimizR/articles/Parameter_estimation_Specific_and_Varietal.html">specific and varietal parameters estimation vignette</a>.</p>
</div>
<div id="set-information-on-the-parameters-to-estimate" class="section level2">
<h2 class="hasAnchor">
<a href="#set-information-on-the-parameters-to-estimate" class="anchor"></a>Set information on the parameters to estimate</h2>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">param_info</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="op">)</span>
<span class="va">param_info</span><span class="op">$</span><span class="va">dlaimax</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>sit_list<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"bou99t3"</span>, <span class="st">"bou00t3"</span>, <span class="st">"bou99t1"</span>, <span class="st">"bou00t1"</span>,
                                        <span class="st">"bo96iN+"</span>, <span class="st">"lu96iN+"</span>, <span class="st">"lu96iN6"</span>, <span class="st">"lu97iN+"</span><span class="op">)</span><span class="op">)</span>,
                        lb<span class="op">=</span><span class="fl">0.0005</span>,ub<span class="op">=</span><span class="fl">0.0025</span><span class="op">)</span>
<span class="va">param_info</span><span class="op">$</span><span class="va">durvieF</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>sit_list<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"bo96iN+"</span>, <span class="st">"lu96iN+"</span>, <span class="st">"lu96iN6"</span>, <span class="st">"lu97iN+"</span><span class="op">)</span>,
                                      <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"bou99t3"</span>, <span class="st">"bou00t3"</span>, <span class="st">"bou99t1"</span>, <span class="st">"bou00t1"</span><span class="op">)</span><span class="op">)</span>,
                        lb<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">50</span>,<span class="fl">100</span><span class="op">)</span>,ub<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">400</span>,<span class="fl">450</span><span class="op">)</span><span class="op">)</span></code></pre></div>
</div>
<div id="set-options-for-the-model" class="section level2">
<h2 class="hasAnchor">
<a href="#set-options-for-the-model" class="anchor"></a>Set options for the model</h2>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">model_options</span><span class="op">=</span> <span class="fu">stics_wrapper_options</span><span class="op">(</span><span class="va">javastics_path</span>, data_dir <span class="op">=</span> <span class="va">stics_inputs_path</span>, parallel<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
</div>
<div id="set-options-for-the-dream-method" class="section level2">
<h2 class="hasAnchor">
<a href="#set-options-for-the-dream-method" class="anchor"></a>Set options for the DREAM method</h2>
<p>The main basic options are set here. The reader can refer to <code>? DREAMzs</code> (see doc for input argument <code>settings</code>) for documentation on more advanced ones. Note that <code>startValue</code> can also be used to provide initial values for the Markov Chains (in that case, it must be a matrix having as many lines as desired number of Markov Chains and a number of columns equivalent to the number of estimated parameters, ordered in the same way as <code>param_info$lb</code> and <code>param_info$ub</code>).</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">optim_options</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="op">)</span> 
<span class="va">optim_options</span><span class="op">$</span><span class="va">iterations</span> <span class="op">&lt;-</span> <span class="fl">10000</span> <span class="co"># Total number of iterations </span>
                                  <span class="co"># (=&gt; optim_options$iterations/optim_options$startValue </span>
                                  <span class="co"># iterations per chain)</span>
<span class="va">optim_options</span><span class="op">$</span><span class="va">startValue</span> <span class="op">&lt;-</span> <span class="fl">3</span> <span class="co"># Number of markov chains</span>
<span class="va">optim_options</span><span class="op">$</span><span class="va">path_results</span> <span class="op">&lt;-</span> <span class="va">data_dir</span> <span class="co"># path where to store the results (graph and Rdata)</span>
<span class="va">optim_options</span><span class="op">$</span><span class="va">ranseed</span> <span class="op">&lt;-</span> <span class="fl">1234</span> <span class="co"># seed for random numbers</span></code></pre></div>
</div>
<div id="run-the-parameter-estimation" class="section level2">
<h2 class="hasAnchor">
<a href="#run-the-parameter-estimation" class="anchor"></a>Run the parameter estimation</h2>
<p>In this case, the parameter estimation algorithm (<code>optim_method</code>argument) and the criterion function (<code>crit_function</code> argument) must be set in input of <code>estim_param</code> function.</p>
<p>The list of available criteria for Bayesian methods is given by <code>? likelihoods</code></p>
<p>The <code>param_info</code> argument has the same content as in the <a href="https://sticsrpacks.github.io/CroptimizR/articles/Parameter_estimation_Specific_and_Varietal.html">specific and varietal parameters estimation vignette</a>.</p>
<p><strong>For the moment, only uniform distributions of bounds <code>param_info$lb</code> and <code>param_info$ub</code> can be used. Other type of distributions will be provided in next versions.</strong></p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">optim_results</span><span class="op">=</span><span class="fu"><a href="../reference/estim_param.html">estim_param</a></span><span class="op">(</span>obs_list<span class="op">=</span><span class="va">obs_list</span>,
                          crit_function<span class="op">=</span><span class="va">likelihood_log_ciidn</span>,
                          model_function<span class="op">=</span><span class="va">stics_wrapper</span>,
                          model_options<span class="op">=</span><span class="va">model_options</span>,
                          optim_options<span class="op">=</span><span class="va">optim_options</span>,
                          optim_method<span class="op">=</span><span class="st">"BayesianTools.dreamzs"</span>,
                          param_info<span class="op">=</span><span class="va">param_info</span><span class="op">)</span></code></pre></div>
<p>The results printed in output on the R console are the following:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## ## # # # # # # # # # # # # # # # # # # # # # # # # #</span>
<span class="co">## ## ## MCMC chain summary ##</span>
<span class="co">## ## # # # # # # # # # # # # # # # # # # # # # # # # #</span>
<span class="co">## ##</span>
<span class="co">## ## # MCMC sampler:  DREAMzs</span>
<span class="co">## ## # Nr. Chains:  3</span>
<span class="co">## ## # Iterations per chain:  2669</span>
<span class="co">## ## # Rejection rate:  0.878</span>
<span class="co">## ## # Effective sample size:  423</span>
<span class="co">## ## # Runtime:  54194.02  sec.</span>
<span class="co">## ##</span>
<span class="co">## ## # Parameters</span>
<span class="co">## ##            psf     MAP    2.5%  median   97.5%</span>
<span class="co">## ## dlaimax  1.045   0.001   0.001   0.001   0.001</span>
<span class="co">## ## durvieF1 1.000 289.864 213.438 311.226 398.462</span>
<span class="co">## ## durvieF2 1.009 208.487 147.158 298.312 443.323</span>
<span class="co">## ##</span>
<span class="co">## ## ## DIC:  442.256</span>
<span class="co">## ## ## Convergence</span>
<span class="co">## ##  Gelman Rubin multivariate psrf:</span>
<span class="co">## ##</span>
<span class="co">## ## ## Correlations</span>
<span class="co">## ##          dlaimax durvieF1 durvieF2</span>
<span class="co">## ## dlaimax    1.000   -0.074   -0.059</span>
<span class="co">## ## durvieF1  -0.074    1.000   -0.029</span>
<span class="co">## ## durvieF2  -0.059   -0.029    1.000</span></code></pre></div>
<p>The rejection rate is the rate of rejection of proposed values. According to (Vrugt, 2016), a value between 0.7 and 0.85 is usually indicative of good performance of a MCMC simulation method.</p>
<p>Effective sample size should be here the number of different values per chain for the parameter vector in the posterior sample.</p>
<p>Under section “parameters” are given statistics on the posterior sample. MAP means Maximum A Posteriori. It is the values of the parameters among the posterior sample that lead to the maximal value of the posterior density.</p>
<p>DIC is the Deviance information criterion. It is a commonly applied method to summarize the fit of an MCMC chain. More details about it can be found in the <a href="https://cran.r-project.org/web/packages/BayesianTools/vignettes/BayesianTools.html">vignette of the BayesianTools package</a>.</p>
<p>The output value of <code>estim_param</code> contains:</p>
<ul>
<li>
<code>statistics</code>, <code>quantiles</code> and <code>MAP</code>: statistics on the posterior sample,</li>
<li>
<code>post_sample</code>, a sample of the posterior distribution (excluding the burnin phase),</li>
<li>
<code>out</code>: the list returned by the package BayesianTools.</li>
</ul>
<p>It is stored with complementary graphs in the <code>optim_options$path_results</code> folder.</p>
<p>Among these graphs, gelmanDiagPlots.pdf plots the evolution of the Gelman diagnostic. According to (Vrugt, 2016) the algorithm is considered to have converged to the posterior distribution when all the values of this diagnostic are inferior to 1.2. In theory the sample of the posterior distribution should thus be taken only after this (WARNING: it is not the case here, neither in BayesianTools, this should be improved).</p>
<p>In this case, we obtain:</p>
<p><img src="ResultsSpecificVarietalDREAM/N10000/Gelman_dlaimax.PNG" width="45%"><img src="ResultsSpecificVarietalDREAM/N10000/Gelman_durvieF1.PNG" width="45%"><img src="ResultsSpecificVarietalDREAM/N10000/Gelman_durvieF2.PNG" width="45%"></p>
<p>Figure 1: Gelman diagnostic.</p>
<p>marginalPlots.pdf shows estimation of the prior (blue) and posterior (pink) densities:</p>
<p><img src="ResultsSpecificVarietalDREAM/N10000/densities_dlaimax.PNG" width="45%"><img src="ResultsSpecificVarietalDREAM/N10000/densities_durvieF1.PNG" width="45%"><img src="ResultsSpecificVarietalDREAM/N10000/densities_durvieF2.PNG" width="45%"></p>
<p>Figure 2: Prior and posterior densities.</p>
<p>correlationPlots.pdf gives information about the correlation between parameters:</p>
<p><img src="ResultsSpecificVarietalDREAM/N10000/correlation_plot.PNG" width="75%"></p>
<p>Figure 3: Correlation plot.</p>
</div>
<div id="launch-a-new-estimation-starting-from-previous-results" class="section level2">
<h2 class="hasAnchor">
<a href="#launch-a-new-estimation-starting-from-previous-results" class="anchor"></a>Launch a new estimation starting from previous results</h2>
<p>In case one wants to increase the number of iterations, because the algorithm has not yet converged or the posterior sample is considered to small, there is a possibility to re-launch the method from the point is has stopped using the <code>PreviousResults</code> option:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">optim_options</span><span class="op">$</span><span class="va">PreviousResults</span><span class="op">=</span><span class="va">optim_results</span><span class="op">$</span><span class="va">out</span>
<span class="va">optim_options</span><span class="op">$</span><span class="va">iterations</span> <span class="op">&lt;-</span> <span class="fl">1000</span> <span class="co"># Total number of new iterations</span>
<span class="va">optim_results</span><span class="op">=</span><span class="fu"><a href="../reference/estim_param.html">estim_param</a></span><span class="op">(</span>obs_list<span class="op">=</span><span class="va">obs_list</span>,
                          crit_function<span class="op">=</span><span class="va">likelihood_log_ciidn</span>,
                          model_function<span class="op">=</span><span class="va">stics_wrapper</span>,
                          model_options<span class="op">=</span><span class="va">model_options</span>,
                          optim_options<span class="op">=</span><span class="va">optim_options</span>,
                          optim_method<span class="op">=</span><span class="st">"BayesianTools.dreamzs"</span>,
                          param_info<span class="op">=</span><span class="va">param_info</span><span class="op">)</span></code></pre></div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Samuel Buis, Michel Giner, Patrice Lecharpentier, SticsRpacks.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
