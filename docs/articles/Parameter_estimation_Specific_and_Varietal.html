<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Parameter estimation with the Stics crop Model: a case with specific and varietal parameters â€¢ CroptimizR</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- sticky kit --><script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Parameter estimation with the Stics crop Model: a case with specific and varietal parameters">
<meta property="og:description" content="">
<meta property="og:image" content="/logo.png">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">CroptimizR</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.0.9001</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/ApsimX_parameter_estimation_simple_case.html">Parameter estimation with the ApsimX crop Model: a simple case</a>
    </li>
    <li>
      <a href="../articles/Available_parameter_estimation_algorithms.html">Available parameter estimation algorithms in CroptimizR</a>
    </li>
    <li>
      <a href="../articles/Designing_a_model_wrapper.html">Guidelines for implementing a crop model R wrapper for CroptimizR</a>
    </li>
    <li>
      <a href="../articles/Parameter_estimation_DREAM.html">Parameter estimation with the DREAM-zs algorithm</a>
    </li>
    <li>
      <a href="../articles/Parameter_estimation_simple_case.html">Parameter estimation with the Stics crop Model: a simple case</a>
    </li>
    <li>
      <a href="../articles/Parameter_estimation_Specific_and_Varietal.html">Parameter estimation with the Stics crop Model: a case with specific and varietal parameters</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/SticsRPacks/CroptimizR">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Parameter estimation with the Stics crop Model: a case with specific and varietal parameters</h1>
                        <h4 class="author">Samuel Buis</h4>
                        
            <h4 class="date">2020-02-02</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/SticsRPacks/CroptimizR/blob/master/vignettes/Parameter_estimation_Specific_and_Varietal.Rmd"><code>vignettes/Parameter_estimation_Specific_and_Varietal.Rmd</code></a></small>
      <div class="hidden name"><code>Parameter_estimation_Specific_and_Varietal.Rmd</code></div>

    </div>

    
    
<div id="study-case" class="section level2">
<h2 class="hasAnchor">
<a href="#study-case" class="anchor"></a>Study Case</h2>
<p>This document presents an example of a simultaneous estimation of one specific and one varietal parameter on a multi-varietal dataset using the Stics model, while a simpler introductory example is presented in this <a href="https://sticsrpacks.github.io/CroptimizR/articles/Parameter_estimation_simple_case.html">vignette</a> (you should look at it first).</p>
<p>Data comes from a maize crop experiment (see description in Wallach et al., 2011). In this example, 8 situations (USMs in Stics language) will be used for the parameter estimation. This test case correspond to case 1c in (Wallach et al., 2011).</p>
<p>The parameter estimation is performed using the Nelder-Meade simplex method implemented in the nloptr package.</p>
</div>
<div id="initialisation-step" class="section level2">
<h2 class="hasAnchor">
<a href="#initialisation-step" class="anchor"></a>Initialisation step</h2>
<p>This part is not shown here, it is the same as this of the <a href="https://sticsrpacks.github.io/CroptimizR/articles/Parameter_estimation_simple_case.html">introductory example</a>.</p>
</div>
<div id="read-and-select-the-corresponding-observations" class="section level2">
<h2 class="hasAnchor">
<a href="#read-and-select-the-corresponding-observations" class="anchor"></a>Read and select the corresponding observations</h2>
<p>In this example, observed LAI are used for all USMs for which there is an observation file in <code><a href="https://www.rdocumentation.org/packages/base/topics/file.path">file.path(data_dir,"XmlFiles")</a></code> folder.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a><span class="co"># Read observation files</span></span>
<span id="cb1-2"><a href="#cb1-2"></a>obs_list=<span class="kw">get_obs</span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/file.path">file.path</a></span>(data_dir,<span class="st">"XmlFiles"</span>))</span>
<span id="cb1-3"><a href="#cb1-3"></a>obs_list=<span class="kw"><a href="../reference/filter_obs.html">filter_obs</a></span>(obs_list, <span class="dt">var_names=</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"lai_n"</span>),<span class="dt">include=</span><span class="ot">TRUE</span>)</span></code></pre></div>
</div>
<div id="set-information-on-the-parameters-to-estimate" class="section level2">
<h2 class="hasAnchor">
<a href="#set-information-on-the-parameters-to-estimate" class="anchor"></a>Set information on the parameters to estimate</h2>
<p><strong><code>param_info</code> allows handling specific / varietal parameters</strong> (dlaimax vs durvieF parameters in this example): dlaimax is defined to take the same value for all situations, whereas durvieF is defined in such a way that it may take one value for situations <code><a href="https://www.rdocumentation.org/packages/base/topics/c">c("bo96iN+", "lu96iN+", "lu96iN6", "lu97iN+")</a></code>, that correspond to a given variety, and another for situations <code><a href="https://www.rdocumentation.org/packages/base/topics/c">c("bou99t3", "bou00t3", "bou99t1", "bou00t1")</a></code>, that correspond to another variety, <code>sit_list</code> being in this case a list of size 2 (see code below). Please note that bounds can take different values for the different groups of situations (lb and ub are vectors of size 2 for durvieF).</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1"></a>param_info=<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/list">list</a></span>()</span>
<span id="cb2-2"><a href="#cb2-2"></a>param_info<span class="op">$</span>dlaimax=<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/list">list</a></span>(<span class="dt">sit_list=</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/list">list</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"bou99t3"</span>, <span class="st">"bou00t3"</span>, <span class="st">"bou99t1"</span>, <span class="st">"bou00t1"</span>, <span class="st">"bo96iN+"</span>, <span class="st">"lu96iN+"</span>, <span class="st">"lu96iN6"</span>, <span class="st">"lu97iN+"</span>)),<span class="dt">lb=</span><span class="fl">0.0005</span>,<span class="dt">ub=</span><span class="fl">0.0025</span>)</span>
<span id="cb2-3"><a href="#cb2-3"></a>param_info<span class="op">$</span>durvieF=<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/list">list</a></span>(<span class="dt">sit_list=</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/list">list</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"bo96iN+"</span>, <span class="st">"lu96iN+"</span>, <span class="st">"lu96iN6"</span>, <span class="st">"lu97iN+"</span>), <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"bou99t3"</span>, <span class="st">"bou00t3"</span>, <span class="st">"bou99t1"</span>, <span class="st">"bou00t1"</span>)),<span class="dt">lb=</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="dv">50</span>,<span class="dv">100</span>),<span class="dt">ub=</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="dv">400</span>,<span class="dv">450</span>))</span></code></pre></div>
</div>
<div id="set-options-for-the-parameter-estimation-method" class="section level2">
<h2 class="hasAnchor">
<a href="#set-options-for-the-parameter-estimation-method" class="anchor"></a>Set options for the parameter estimation method</h2>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1"></a>optim_options=<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/list">list</a></span>() </span>
<span id="cb3-2"><a href="#cb3-2"></a>optim_options<span class="op">$</span>nb_rep &lt;-<span class="st"> </span><span class="dv">7</span> <span class="co"># Number of repetitions of the minimization </span></span>
<span id="cb3-3"><a href="#cb3-3"></a>                          <span class="co"># (each time starting with different initial</span></span>
<span id="cb3-4"><a href="#cb3-4"></a>                          <span class="co"># values for the estimated parameters) </span></span>
<span id="cb3-5"><a href="#cb3-5"></a>optim_options<span class="op">$</span>maxeval &lt;-<span class="st"> </span><span class="dv">1000</span> <span class="co"># Maximum number of evaluations of the </span></span>
<span id="cb3-6"><a href="#cb3-6"></a>                            <span class="co"># minimized criteria </span></span>
<span id="cb3-7"><a href="#cb3-7"></a>optim_options<span class="op">$</span>xtol_rel &lt;-<span class="st"> </span><span class="fl">1e-04</span> <span class="co"># Tolerance criterion between two iterations</span></span>
<span id="cb3-8"><a href="#cb3-8"></a>                                <span class="co"># (threshold for the relative difference of</span></span>
<span id="cb3-9"><a href="#cb3-9"></a>                                <span class="co"># parameter values between the 2 previous </span></span>
<span id="cb3-10"><a href="#cb3-10"></a>                                <span class="co"># iterations)</span></span>
<span id="cb3-11"><a href="#cb3-11"></a>optim_options<span class="op">$</span>path_results &lt;-<span class="st"> </span>data_dir <span class="co"># path where to store the results (graph and Rdata)</span></span>
<span id="cb3-12"><a href="#cb3-12"></a>optim_options<span class="op">$</span>ranseed &lt;-<span class="st"> </span><span class="dv">1234</span> <span class="co"># random seed  </span></span></code></pre></div>
</div>
<div id="run-the-optimization" class="section level2">
<h2 class="hasAnchor">
<a href="#run-the-optimization" class="anchor"></a>Run the optimization</h2>
<p>The Nelder-Meade simplex is the default method =&gt; no need to set the optim_method argument. For the moment it is the only method interfaced (others will come soon). Same for crit_function: a value is set by default (<code>crit_log_cwss</code>, see <code><a href="../reference/ls_criteria.html">? crit_log_cwss</a></code> for more details and list of available criteria). Others will be proposed in next versions of CroptimizR. The user can implement and give in argument its own criterion (see inputs and outputs required in the <code>crit_log_cwss</code> function).</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1"></a>optim_results=<span class="kw"><a href="../reference/estim_param.html">estim_param</a></span>(<span class="dt">obs_list=</span>obs_list,</span>
<span id="cb4-2"><a href="#cb4-2"></a>                            <span class="dt">model_function=</span>stics_wrapper,</span>
<span id="cb4-3"><a href="#cb4-3"></a>                            <span class="dt">model_options=</span>model_options,</span>
<span id="cb4-4"><a href="#cb4-4"></a>                            <span class="dt">optim_options=</span>optim_options,</span>
<span id="cb4-5"><a href="#cb4-5"></a>                            <span class="dt">param_info=</span>param_info)</span></code></pre></div>
<p>The results printed in output on the R console are the following:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1"></a><span class="co">## [1] "Estimated value for dlaimax :  0.00112078439658861"</span></span>
<span id="cb5-2"><a href="#cb5-2"></a><span class="co">## [1] "Estimated value for durvieF1 :  400"</span></span>
<span id="cb5-3"><a href="#cb5-3"></a><span class="co">## [1] "Estimated value for durvieF2 :  213.495265823847"</span></span>
<span id="cb5-4"><a href="#cb5-4"></a><span class="co">## [1] "Minimum value of the criterion: -1.48441926984469"</span></span></code></pre></div>
<p>Complementary graphs and data are stored in the <code>optim_options$path_results</code> folder. Among them, the EstimatedVSinit.pdf file contains the following figures:</p>
<p><img src="ResultsSpecificVarietal/estimInit_dlaimax.PNG" width="45%"><img src="ResultsSpecificVarietal/estimInit_durvieF_var1.PNG" width="45%"><img src="ResultsSpecificVarietal/estimInit_durvieF_var2.PNG" width="45%"></p>
<p>Figure 1: plots of estimated vs initial values of parameters dlaimax and durvieF (estimated for both varieties).</p>
</div>
<div id="compare-simulations-and-observations-before-and-after-optimization" class="section level2">
<h2 class="hasAnchor">
<a href="#compare-simulations-and-observations-before-and-after-optimization" class="anchor"></a>Compare simulations and observations before and after optimization</h2>
<p>A couple of plots to check if the calibration reduced the difference between simulations and observations.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1"></a><span class="co"># Install a few packages needed for the following</span></span>
<span id="cb6-2"><a href="#cb6-2"></a><span class="cf">if</span>(<span class="op">!</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">require</a></span>(<span class="st">"gridExtra"</span>)){</span>
<span id="cb6-3"><a href="#cb6-3"></a>  <span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/install.packages">install.packages</a></span>(<span class="st">"gridExtra"</span>,<span class="dt">repos=</span><span class="st">"http://cran.irsn.fr"</span>)</span>
<span id="cb6-4"><a href="#cb6-4"></a>  <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(<span class="st">"gridExtra"</span>)</span>
<span id="cb6-5"><a href="#cb6-5"></a>}</span>
<span id="cb6-6"><a href="#cb6-6"></a><span class="cf">if</span>(<span class="op">!</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">require</a></span>(<span class="st">"hydroGOF"</span>)){</span>
<span id="cb6-7"><a href="#cb6-7"></a>  <span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/install.packages">install.packages</a></span>(<span class="st">"hydroGOF"</span>,<span class="dt">repos=</span><span class="st">"http://cran.irsn.fr"</span>)</span>
<span id="cb6-8"><a href="#cb6-8"></a>  <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(<span class="st">"hydroGOF"</span>)</span>
<span id="cb6-9"><a href="#cb6-9"></a>}</span>
<span id="cb6-10"><a href="#cb6-10"></a><span class="cf">if</span>(<span class="op">!</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">require</a></span>(<span class="st">"grid"</span>)){</span>
<span id="cb6-11"><a href="#cb6-11"></a>  <span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/install.packages">install.packages</a></span>(<span class="st">"grid"</span>,<span class="dt">repos=</span><span class="st">"http://cran.irsn.fr"</span>)</span>
<span id="cb6-12"><a href="#cb6-12"></a>  <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(<span class="st">"grid"</span>)</span>
<span id="cb6-13"><a href="#cb6-13"></a>}</span>
<span id="cb6-14"><a href="#cb6-14"></a><span class="cf">if</span>(<span class="op">!</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">require</a></span>(<span class="st">"dplyr"</span>)){</span>
<span id="cb6-15"><a href="#cb6-15"></a>  <span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/install.packages">install.packages</a></span>(<span class="st">"dplyr"</span>,<span class="dt">repos=</span><span class="st">"http://cran.irsn.fr"</span>)</span>
<span id="cb6-16"><a href="#cb6-16"></a>  <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(<span class="st">"dplyr"</span>)</span>
<span id="cb6-17"><a href="#cb6-17"></a>}</span>
<span id="cb6-18"><a href="#cb6-18"></a><span class="cf">if</span>(<span class="op">!</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">require</a></span>(<span class="st">"ggplot2"</span>)){</span>
<span id="cb6-19"><a href="#cb6-19"></a>  <span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/install.packages">install.packages</a></span>(<span class="st">"ggplot2"</span>,<span class="dt">repos=</span><span class="st">"http://cran.irsn.fr"</span>)</span>
<span id="cb6-20"><a href="#cb6-20"></a>  <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(<span class="st">"ggplot2"</span>)</span>
<span id="cb6-21"><a href="#cb6-21"></a>}</span>
<span id="cb6-22"><a href="#cb6-22"></a><span class="co"># Run the model without and with forcing the optimized values of the parameters</span></span>
<span id="cb6-23"><a href="#cb6-23"></a>sim_before_optim=<span class="kw">stics_wrapper</span>(<span class="dt">model_options=</span>model_options)</span>
<span id="cb6-24"><a href="#cb6-24"></a>sim_after_optim=<span class="kw">stics_wrapper</span>(<span class="dt">param_values=</span>optim_results<span class="op">$</span>final_values,</span>
<span id="cb6-25"><a href="#cb6-25"></a>                              <span class="dt">model_options=</span>model_options)</span>
<span id="cb6-26"><a href="#cb6-26"></a>  </span>
<span id="cb6-27"><a href="#cb6-27"></a><span class="co"># transform into data.frame and intersect for using ggplot2</span></span>
<span id="cb6-28"><a href="#cb6-28"></a>sim_before_df =<span class="st"> </span><span class="kw">bind_rows</span>(sim_before_optim<span class="op">$</span>sim_list[[<span class="dv">1</span>]],<span class="dt">.id =</span> <span class="st">'Situation'</span>)</span>
<span id="cb6-29"><a href="#cb6-29"></a>sim_after_df =<span class="st"> </span><span class="kw">bind_rows</span>(sim_after_optim<span class="op">$</span>sim_list[[<span class="dv">1</span>]],<span class="dt">.id =</span> <span class="st">'Situation'</span>)</span>
<span id="cb6-30"><a href="#cb6-30"></a>obs_df =<span class="st"> </span><span class="kw">bind_rows</span>(obs_list,<span class="dt">.id =</span> <span class="st">'Situation'</span>)</span>
<span id="cb6-31"><a href="#cb6-31"></a>sim_before_df =<span class="st"> </span><span class="kw">rename</span>(sim_before_df,<span class="dt">LAI_sim=</span>lai_n)</span>
<span id="cb6-32"><a href="#cb6-32"></a>sim_after_df =<span class="st"> </span><span class="kw">rename</span>(sim_after_df,<span class="dt">LAI_sim=</span>lai_n)</span>
<span id="cb6-33"><a href="#cb6-33"></a>obs_df =<span class="st"> </span><span class="kw">rename</span>(obs_df,<span class="dt">LAI_obs=</span>lai_n)</span>
<span id="cb6-34"><a href="#cb6-34"></a>sim_before_obs_df =<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/merge">merge.data.frame</a></span>(sim_before_df,obs_df,<span class="dt">by =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">'Situation'</span>,<span class="st">'Date'</span>), <span class="dt">all.x =</span> <span class="ot">TRUE</span>)</span>
<span id="cb6-35"><a href="#cb6-35"></a>sim_after_obs_df =<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/merge">merge.data.frame</a></span>(sim_after_df,obs_df,<span class="dt">by =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">'Situation'</span>,<span class="st">'Date'</span>), <span class="dt">all.x =</span> <span class="ot">TRUE</span>)</span>
<span id="cb6-36"><a href="#cb6-36"></a><span class="co"># Compute RMSE</span></span>
<span id="cb6-37"><a href="#cb6-37"></a>rmse_before =<span class="st"> </span><span class="kw">rmse</span>(sim_before_obs_df<span class="op">$</span>LAI_obs,sim_before_obs_df<span class="op">$</span>LAI_sim)</span>
<span id="cb6-38"><a href="#cb6-38"></a>rmse_after =<span class="st"> </span><span class="kw">rmse</span>(sim_after_obs_df<span class="op">$</span>LAI_obs,sim_after_obs_df<span class="op">$</span>LAI_sim)</span>
<span id="cb6-39"><a href="#cb6-39"></a><span class="co"># Plot the graphs</span></span>
<span id="cb6-40"><a href="#cb6-40"></a>max_LAI_sim=<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/Extremes">max</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(sim_before_obs_df<span class="op">$</span>LAI_sim,sim_after_obs_df<span class="op">$</span>LAI_sim,<span class="dt">na.rm=</span><span class="ot">TRUE</span>),<span class="dt">na.rm=</span><span class="ot">TRUE</span>)</span>
<span id="cb6-41"><a href="#cb6-41"></a>max_LAI_obs=<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/Extremes">max</a></span>(sim_before_obs_df<span class="op">$</span>LAI_obs,<span class="dt">na.rm=</span><span class="ot">TRUE</span>)</span>
<span id="cb6-42"><a href="#cb6-42"></a>p1=<span class="kw">ggplot</span>(sim_before_obs_df, <span class="kw">aes</span>(<span class="dt">x =</span> LAI_obs, <span class="dt">y =</span> LAI_sim)) <span class="op">+</span><span class="st"> </span></span>
<span id="cb6-43"><a href="#cb6-43"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">shape=</span><span class="dv">21</span>, <span class="dt">size =</span> <span class="dv">3</span>, <span class="dt">color =</span> <span class="st">'blue'</span>,</span>
<span id="cb6-44"><a href="#cb6-44"></a>             <span class="dt">fill=</span><span class="st">"white"</span>,<span class="dt">alpha =</span> <span class="fl">0.8</span>,<span class="dt">stroke =</span> <span class="dv">1</span>) <span class="op">+</span></span>
<span id="cb6-45"><a href="#cb6-45"></a><span class="st">  </span><span class="kw">theme</span>(<span class="dt">text =</span> <span class="kw">element_text</span>(<span class="dt">size=</span><span class="dv">16</span>)) <span class="op">+</span><span class="st"> </span></span>
<span id="cb6-46"><a href="#cb6-46"></a><span class="st">  </span><span class="kw">theme</span>(<span class="dt">aspect.ratio=</span><span class="dv">1</span>) <span class="op">+</span></span>
<span id="cb6-47"><a href="#cb6-47"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">"Observed LAI"</span>, <span class="dt">y =</span> <span class="st">"Simulated LAI"</span>) <span class="op">+</span></span>
<span id="cb6-48"><a href="#cb6-48"></a><span class="st">  </span><span class="kw">geom_abline</span>(<span class="dt">intercept =</span> <span class="dv">0</span>, <span class="dt">slope =</span> <span class="dv">1</span>, <span class="dt">size =</span> <span class="fl">0.5</span>, <span class="dt">color =</span> <span class="st">"blue"</span>) <span class="op">+</span></span>
<span id="cb6-49"><a href="#cb6-49"></a><span class="st">  </span><span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/plot.window">xlim</a></span>(<span class="dv">0</span>,max_LAI_obs) <span class="op">+</span><span class="st">  </span><span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/plot.window">ylim</a></span>(<span class="dv">0</span>,max_LAI_sim) <span class="op">+</span></span>
<span id="cb6-50"><a href="#cb6-50"></a><span class="st">  </span><span class="kw">ggtitle</span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/paste">paste</a></span>(<span class="st">"Before optimization </span><span class="ch">\n</span><span class="st"> RMSE="</span>,<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/Round">round</a></span>(rmse_before,<span class="dv">2</span>))) <span class="op">+</span></span>
<span id="cb6-51"><a href="#cb6-51"></a><span class="st">  </span><span class="kw">theme</span>(<span class="dt">plot.title =</span> <span class="kw">element_text</span>(<span class="dt">hjust =</span> <span class="fl">0.5</span>))</span>
<span id="cb6-52"><a href="#cb6-52"></a>p2=<span class="kw">ggplot</span>(sim_after_obs_df, <span class="kw">aes</span>(<span class="dt">x =</span> LAI_obs, <span class="dt">y =</span> LAI_sim)) <span class="op">+</span><span class="st"> </span></span>
<span id="cb6-53"><a href="#cb6-53"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">shape=</span><span class="dv">21</span>, <span class="dt">size =</span> <span class="dv">3</span>, <span class="dt">color =</span> <span class="st">'blue'</span>,</span>
<span id="cb6-54"><a href="#cb6-54"></a>             <span class="dt">fill=</span><span class="st">"white"</span>,<span class="dt">alpha =</span> <span class="fl">0.8</span>,<span class="dt">stroke =</span> <span class="dv">1</span>) <span class="op">+</span></span>
<span id="cb6-55"><a href="#cb6-55"></a><span class="st">  </span><span class="kw">theme</span>(<span class="dt">text =</span> <span class="kw">element_text</span>(<span class="dt">size=</span><span class="dv">16</span>)) <span class="op">+</span><span class="st"> </span></span>
<span id="cb6-56"><a href="#cb6-56"></a><span class="st">  </span><span class="kw">theme</span>(<span class="dt">aspect.ratio=</span><span class="dv">1</span>) <span class="op">+</span></span>
<span id="cb6-57"><a href="#cb6-57"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">"Observed LAI"</span>, <span class="dt">y =</span> <span class="st">"Simulated LAI"</span>) <span class="op">+</span></span>
<span id="cb6-58"><a href="#cb6-58"></a><span class="st">  </span><span class="kw">geom_abline</span>(<span class="dt">intercept =</span> <span class="dv">0</span>, <span class="dt">slope =</span> <span class="dv">1</span>, <span class="dt">size =</span> <span class="fl">0.5</span>, <span class="dt">color =</span> <span class="st">"blue"</span>) <span class="op">+</span></span>
<span id="cb6-59"><a href="#cb6-59"></a><span class="st">  </span><span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/plot.window">xlim</a></span>(<span class="dv">0</span>,max_LAI_obs) <span class="op">+</span><span class="st">  </span><span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/plot.window">ylim</a></span>(<span class="dv">0</span>,max_LAI_sim) <span class="op">+</span></span>
<span id="cb6-60"><a href="#cb6-60"></a><span class="st">  </span><span class="kw">ggtitle</span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/paste">paste</a></span>(<span class="st">"After optimization </span><span class="ch">\n</span><span class="st"> RMSE="</span>,<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/Round">round</a></span>(rmse_after,<span class="dv">2</span>))) <span class="op">+</span></span>
<span id="cb6-61"><a href="#cb6-61"></a><span class="st">  </span><span class="kw">theme</span>(<span class="dt">plot.title =</span> <span class="kw">element_text</span>(<span class="dt">hjust =</span> <span class="fl">0.5</span>))</span>
<span id="cb6-62"><a href="#cb6-62"></a>p=<span class="kw">grid.arrange</span>(<span class="dt">grobs=</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/list">list</a></span>(p1,p2), <span class="dt">nrow=</span><span class="dv">1</span>, <span class="dt">ncol=</span><span class="dv">2</span>)</span>
<span id="cb6-63"><a href="#cb6-63"></a><span class="co"># Save the graph</span></span>
<span id="cb6-64"><a href="#cb6-64"></a><span class="kw">ggsave</span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/file.path">file.path</a></span>(optim_options<span class="op">$</span>path_results,</span>
<span id="cb6-65"><a href="#cb6-65"></a>                 <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/paste">paste0</a></span>(<span class="st">"sim_obs"</span>,<span class="st">".png"</span>)), <span class="dt">plot=</span>p)</span></code></pre></div>
<p>This gives:</p>
<div class="figure">
<img src="ResultsSpecificVarietal/sim_obs.png" alt="Figure 2: plots of simulated vs observed LAI before and after optimization. The gap between simulated and observed values has been drastically reduced: the minimizer has done its job!" width="80%"><p class="caption">
Figure 2: plots of simulated vs observed LAI before and after optimization. The gap between simulated and observed values has been drastically reduced: the minimizer has done its job!
</p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#study-case">Study Case</a></li>
      <li><a href="#initialisation-step">Initialisation step</a></li>
      <li><a href="#read-and-select-the-corresponding-observations">Read and select the corresponding observations</a></li>
      <li><a href="#set-information-on-the-parameters-to-estimate">Set information on the parameters to estimate</a></li>
      <li><a href="#set-options-for-the-parameter-estimation-method">Set options for the parameter estimation method</a></li>
      <li><a href="#run-the-optimization">Run the optimization</a></li>
      <li><a href="#compare-simulations-and-observations-before-and-after-optimization">Compare simulations and observations before and after optimization</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Samuel Buis, Michel Giner, Patrice Lecharpentier, SticsRpacks.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.3.0.</p>
</div>
      </footer>
</div>

  

  </body>
</html>
