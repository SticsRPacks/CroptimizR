<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Calibrating a complex crop model using the AgMIP protocol • CroptimizR</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="48x48" href="../favicon-48x48.png">
<link rel="icon" type="”image/svg+xml”" href="../favicon.svg">
<link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
<link rel="icon" sizes="any" href="../favicon.ico">
<link rel="manifest" href="../site.webmanifest">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Calibrating a complex crop model using the AgMIP protocol">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">


    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">CroptimizR</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">1.0.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../articles/CroptimizR.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles

    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/Available_parameter_estimation_algorithms.html">Available parameter estimation algorithms in CroptimizR</a>
    </li>
    <li>
      <a href="../articles/Designing_a_model_wrapper.html">Guidelines for implementing a crop model R wrapper for CroptimizR</a>
    </li>
    <li>
      <a href="../articles/Parameter_estimation_simple_case.html">Parameter estimation with CroptimizR: a simple case using the STICS crop Model</a>
    </li>
    <li>
      <a href="../articles/Parameter_selection.html">Parameter selection with CroptimizR</a>
    </li>
    <li>
      <a href="../articles/AgMIP_Calibration_Protocol.html">Calibrating a complex crop model using the AgMIP protocol</a>
    </li>
    <li>
      <a href="../articles/Parameter_estimation_Specific_and_Varietal.html">Parameter estimation with CroptimizR: a case with specific and varietal parameters</a>
    </li>
    <li>
      <a href="../articles/ApsimX_parameter_estimation_simple_case.html">Parameter estimation with CroptimizR: a simple case using the ApsimX crop Model</a>
    </li>
    <li>
      <a href="../articles/Parameter_estimation_DREAM.html">Parameter estimation with the DREAM-zs algorithm</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/SticsRPacks/CroptimizR/" class="external-link">
    <span class="fab fa-github fa-lg"></span>

  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->



      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Calibrating a complex crop model using the AgMIP
protocol</h1>
                        <h4 data-toc-skip class="author">Samuel
Buis</h4>
                        
            <h4 data-toc-skip class="date">2026-02-04</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/SticsRPacks/CroptimizR/blob/main/vignettes/AgMIP_Calibration_Protocol.Rmd" class="external-link"><code>vignettes/AgMIP_Calibration_Protocol.Rmd</code></a></small>
      <div class="hidden name"><code>AgMIP_Calibration_Protocol.Rmd</code></div>

    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>This vignette illustrates the use of the
<code>run_protocol_agmip</code> function on a realistic and complex crop
model (STICS) and a multi-environment dataset. Its goal is to
demonstrate the complete workflow, from protocol specification to the
analysis of results.</p>
<p>This document intentionally focuses on a representative use case and
does not aim at exhaustively documenting all features of the function.
Advanced options (e.g. parameter constraints, variable transformations,
custom optimization settings, alternative information criteria) are
therefore not covered here and are documented in the function reference
manual (<code><a href="../reference/run_protocol_agmip.html">?CroptimizR::run_protocol_agmip</a></code>).</p>
<p>The AgMIP calibration protocol is described in detail in <a href="https://www.sciencedirect.com/science/article/pii/S1364815224002081" class="external-link">Wallach
et al (2024)</a> and <a href="https://www.sciencedirect.com/science/article/pii/S1161030125001558" class="external-link">Wallach
et al (2025)</a>. Only a brief contextual description is given here.</p>
</div>
<div class="section level2">
<h2 id="scientific-and-technical-context">Scientific and technical context<a class="anchor" aria-label="anchor" href="#scientific-and-technical-context"></a>
</h2>
<div class="section level3">
<h3 id="the-agmip-calibration-protocol">The AgMIP calibration protocol<a class="anchor" aria-label="anchor" href="#the-agmip-calibration-protocol"></a>
</h3>
<p>The AgMIP calibration protocol is a two-step procedure:</p>
<ul>
<li>Step 6: sequential parameter estimation by groups of variables, with
automatic selection of candidate parameters based on an information
criterion.</li>
<li>Step 7: joint re-estimation of all selected parameters using all
available observations, by weighted least squares.</li>
</ul>
<p>In this vignette, we focus on how to describe and run this protocol
using CroptimizR, not on re-describing the protocol itself. The reader
is referred to Wallach et al. (2024, 2025) for the scientific rationale.
A more detailed, implementation-oriented description of the protocol,
including the precise sequence of operations, default settings,
optimization strategy, and selection rules, as implemented in CroptimizR
is provided in the documentation of <code>run_protocol_agmip</code>.</p>
</div>
<div class="section level3">
<h3 id="the-stics-model-and-croptimizr-wrappers">The STICS model and CroptimizR wrappers<a class="anchor" aria-label="anchor" href="#the-stics-model-and-croptimizr-wrappers"></a>
</h3>
<p>This example uses the STICS crop model, but CroptimizR can in fact be
applied to any crop model, provided that a suitable wrapper is
available. Guidelines and examples for implementing wrappers are
provided in the vignette: <a href="https://sticsrpacks.github.io/CroptimizR/articles/Designing_a_model_wrapper.html" class="external-link uri">https://sticsrpacks.github.io/CroptimizR/articles/Designing_a_model_wrapper.html</a></p>
<p>Note that wrappers already exist for several models. For more
details, see the <a href="https://sticsrpacks.github.io/CroptimizR/articles/CroptimizR.html" class="external-link">Get
started page</a> or contact the authors.</p>
</div>
<div class="section level3">
<h3 id="the-dataset">The dataset<a class="anchor" aria-label="anchor" href="#the-dataset"></a>
</h3>
<p>The dataset used in this example comes from the synthetic experiment
defined in Wallach et al. (2024).</p>
<p>It includes 22 environments (called situations in CroptimizR
terminology). Fourteen situations are used for calibration (six
different sites, five different years) and eight for evaluation. Each
situation includes all the necessary information to run the crop model
(soil, management, weather). Corresponding STICS input files were
prepared beforehand.</p>
</div>
</div>
<div class="section level2">
<h2 id="observations-and-data-formatting">Observations and data formatting<a class="anchor" aria-label="anchor" href="#observations-and-data-formatting"></a>
</h2>
<div class="section level3">
<h3 id="observed-variables">Observed variables<a class="anchor" aria-label="anchor" href="#observed-variables"></a>
</h3>
<p>The observed variables used for model calibration in this example
include:</p>
<ul>
<li>days from 1st January of the sowing year to BBCH30, BBCH55, and
BBCH90 (STICS variables <code>iamfs</code>, <code>ilaxs</code>, and
<code>imats</code>),</li>
<li>biomass at various dates (STICS variable <code>masec_n</code>), in
t.ha-1,</li>
<li>grain number (STICS variable <code>chargefruit</code>), in
grains.m-2,</li>
<li>grain yield (STICS variable <code>mafruit</code>), in t.ha-1.</li>
</ul>
<p>Observations of plant nitrogen content and seed protein, which were
part of the original dataset, are not included here because they are not
directly simulated by the STICS model. They could be derived from
variables simulated by STICS using the <code>transform_sim</code>
argument (as done in Wallach et al., 2024), but this is not illustrated
here for the sake of simplicity.</p>
</div>
<div class="section level3">
<h3 id="the-cropr-format">The cropr format<a class="anchor" aria-label="anchor" href="#the-cropr-format"></a>
</h3>
<p>All observations must be formatted in the <code>cropr</code> format,
i.e. as a named list of data frames (or tibble), each element being
named after the corresponding situation (see the <a href="https://sticsrpacks.github.io/CroptimizR/articles/CroptimizR.html" class="external-link">Get
started</a> vignette of CroptimizR for details).</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">obs_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">readRDS</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"AgMIP_protocol"</span>, <span class="st">"vignette_data"</span><span class="op">)</span>,</span>
<span>  package <span class="op">=</span> <span class="st">"CroptimizR"</span></span>
<span><span class="op">)</span>, <span class="st">"obs_list.Rds"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Show the first two situations</span></span>
<span><span class="va">obs_list</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">]</span></span>
<span><span class="co">#&gt; $`Site2-culA-10-tec2`</span></span>
<span><span class="co">#&gt;         Date iamfs ilaxs imats masec_n chargefruit  mafruit</span></span>
<span><span class="co">#&gt; 1 2010-12-31   455   509   556      NA    13539.42 3.808691</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $`Site2-culA-11-tec7`</span></span>
<span><span class="co">#&gt;         Date iamfs ilaxs imats   masec_n chargefruit mafruit</span></span>
<span><span class="co">#&gt; 1 2011-04-01    NA    NA    NA 0.8574894          NA      NA</span></span>
<span><span class="co">#&gt; 2 2011-04-20    NA    NA    NA 3.3697419          NA      NA</span></span>
<span><span class="co">#&gt; 3 2011-04-29    NA    NA    NA 4.7809235          NA      NA</span></span>
<span><span class="co">#&gt; 4 2011-05-19    NA    NA    NA 6.7784120          NA      NA</span></span>
<span><span class="co">#&gt; 5 2011-12-31   450   492   544        NA          NA      NA</span></span></code></pre></div>
<p>Here, we displayed the available observations for the first two
situations, <code>Site2-culA-10-tec2</code> and
<code>Site2-culA-11-tec7</code>. In this example, end-of-season
observations are assigned to the last day of the year to ensure that
these observed values are compared with the final simulated values.</p>
</div>
</div>
<div class="section level2">
<h2 id="describing-the-calibration-protocol">Describing the calibration protocol<a class="anchor" aria-label="anchor" href="#describing-the-calibration-protocol"></a>
</h2>
<div class="section level3">
<h3 id="principle">Principle<a class="anchor" aria-label="anchor" href="#principle"></a>
</h3>
<p>Describing the AgMIP protocol for CroptimizR essentially requires
specifying:</p>
<ul>
<li>the groups of observed variables and their order of use in Step
6,</li>
<li>the list of major and candidate parameters associated with each
group,</li>
<li>the default values and bounds of all parameters.</li>
</ul>
</div>
<div class="section level3">
<h3 id="excel-based-specification">Excel-based specification<a class="anchor" aria-label="anchor" href="#excel-based-specification"></a>
</h3>
<p>This information can be provided using a single Excel file containing
at least three sheets named:</p>
<ul>
<li>
<code>variables</code>,</li>
<li>
<code>major_parameters</code>,</li>
<li>
<code>candidate_parameters</code>.</li>
</ul>
<p>In this example, this file is named
<code>agmip_protocol_vignette.xlsx</code> and is located in the
<code>data/AgMIP_protocol</code> folder. Here is a preview of this
file:</p>
<p><img src="../../../../../../private/var/folders/yz/zr09txvs5dn18vt4cn21kzl40000gn/T/RtmpInvDaS/temp_libpath2dab3b013723/CroptimizR/extdata/AgMIP_protocol/vignette_data/protocol_descr_file.png" class="r-plt" alt="" width="90%"></p>
<p>The order of the variable groups in the <code>variables</code> sheet
is particularly important, as it determines their sequence in Step 6 of
the protocol.</p>
<p>The <code>descriptions</code> columns are not used by CroptimizR and
are optional. They are only useful for documentation purposes.</p>
<p>Note that CroptimizR provides helper functions to make it easy to get
started with the Excel-based protocol specification:</p>
<ul>
<li>
<code><a href="../reference/get_agmip_protocol_template.html">get_agmip_protocol_template()</a></code> returns the official
Excel template that must be filled by the user to define a new
protocol.</li>
<li>
<code><a href="../reference/get_agmip_protocol_example.html">get_agmip_protocol_example()</a></code> provides a fully worked
example.</li>
</ul>
<p>Although the protocol is provided here as an Excel file for
convenience and readability, the calibration procedure actually relies
on two R objects, <code>step</code> and <code>param_info</code>, which
fully describe the protocol. In the following section, we examine their
structure to understand how the protocol is defined for this specific
example.</p>
</div>
<div class="section level3">
<h3 id="converting-the-excel-file-to-r-objects">Converting the Excel file to R objects<a class="anchor" aria-label="anchor" href="#converting-the-excel-file-to-r-objects"></a>
</h3>
<p>The Excel file is converted into R data structures using the
<code>load_protocol_agmip</code> function.</p>
<p>Here, we load the protocol description file associated with this
vignette:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">protocol_descr</span> <span class="op">&lt;-</span> <span class="fu">CroptimizR</span><span class="fu">::</span><span class="fu"><a href="../reference/load_protocol_agmip.html">load_protocol_agmip</a></span><span class="op">(</span></span>
<span>  protocol_file_path <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"AgMIP_protocol"</span>, <span class="st">"agmip_protocol_vignette.xlsx"</span><span class="op">)</span>,</span>
<span>    package <span class="op">=</span> <span class="st">"CroptimizR"</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">protocol_descr</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "step"       "param_info"</span></span>
<span><span class="va">step</span> <span class="op">&lt;-</span> <span class="va">protocol_descr</span><span class="op">$</span><span class="va">step</span></span>
<span><span class="va">param_info</span> <span class="op">&lt;-</span> <span class="va">protocol_descr</span><span class="op">$</span><span class="va">param_info</span></span></code></pre></div>
<p>In this case, the function returns a list with two elements:
<code>step</code> and <code>param_info</code>. We assigned them to two
separate objects to improve readability in the rest of the report and
code. These two objects are the core inputs needed to describe Step 6 of
the protocol.</p>
<blockquote>
<p>Note that creating this Excel file is not mandatory. Users may
directly build these R objects by hand, but the Excel-based workflow is
recommended for clarity, reproducibility, and ease of editing.</p>
</blockquote>
</div>
<div class="section level3">
<h3 id="structure-of-the-protocol-for-this-example">Structure of the protocol for this example<a class="anchor" aria-label="anchor" href="#structure-of-the-protocol-for-this-example"></a>
</h3>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">step</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "phenology"     "plant_biomass" "grain_number"  "yield"</span></span></code></pre></div>
<p>Given the available observed variables and the structure of the STICS
model, the order defined for the successive groups in Step 6 is:</p>
<p>phenology → plant_biomass → grain_number → yield</p>
<p>Parameters associated with the phenology group are therefore
estimated first and then fixed to their estimated values in the
subsequent groups. Then parameters of the plant_biomass group are
estimated, and so on.</p>
<p>The order of the groups is chosen to minimize feedback, i.e. the
influence of a simulated variable on variables that appear earlier in
the sequence.</p>
<p>Phenology defines the timing of the main developmental stages of the
crop cycle. Plant biomass accumulation depends on these stages and on
their synchronisation with environmental conditions. Finally, yield
components (first grain number, then grain weight, during two successive
phenological phases) depend on biomass growth rate and on the amount of
accumulated vegetative biomass. All these processes are therefore
interdependent and occur in a well-defined causal order in the STICS
model, which is reflected in the calibration strategy.</p>
</div>
<div class="section level3">
<h3 id="example-the-phenology-group">Example: the phenology group<a class="anchor" aria-label="anchor" href="#example-the-phenology-group"></a>
</h3>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">step</span><span class="op">[[</span><span class="st">"phenology"</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="co">#&gt; $major_param</span></span>
<span><span class="co">#&gt; [1] "stlevamf" "stamflax" "stdrpmat"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $candidate_param</span></span>
<span><span class="co">#&gt; [1] "jvc"       "sensrsec"  "belong"    "jvcmini"   "stressdev"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $obs_var</span></span>
<span><span class="co">#&gt; [1] "iamfs" "ilaxs" "imats"</span></span></code></pre></div>
<p>The major parameters should be chosen with the main goal of reducing
bias. A good choice is typically a parameter that affects the simulated
values in all environments and behaves approximately like an additive
constant.</p>
<p>For phenology, the major parameters chosen here are the thermal time
requirements to reach the different observed stages:
<code>stlevamf</code>, <code>stamflax</code>, <code>stdrpmat</code>.</p>
<p>For this group, there are three major parameters because there are
three observed variables (BBCH30, BBCH55, BBCH90). The protocol
recommends selecting one major parameter per observed variable. For
groups with multiple measurements over time, it is common to select two
or three major parameters (but rarely more), typically either parameters
that affect the variable at different periods of the crop cycle, or
parameters that separately control the average level and the rate of
change over time.</p>
<p>The candidate parameters are those expected to explain part of the
variability between environments. They should be ordered, as far as
possible, by decreasing expected importance. There is no strict limit on
their number, but increasing it increases computation time.</p>
<p>In this example, five candidate parameters are used for the phenology
group: <code>jvc</code>, <code>sensrsec</code>, <code>belong</code>,
<code>jvcmini</code>, <code>stressdev</code>. They were ordered based on
expert knowledge of the STICS model.</p>
<p>During calibration of the different groups, the major parameters are
first estimated. Then candidate parameters are added one by one to the
list of estimated parameters and kept only if the resulting information
criterion value (AICc by default) improves. Non-selected candidates are
fixed to their default values, as are all parameters belonging to groups
that have not yet been processed.</p>
</div>
<div class="section level3">
<h3 id="parameter-information">Parameter information<a class="anchor" aria-label="anchor" href="#parameter-information"></a>
</h3>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Display only the first lines of each component for readability</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">param_info</span>, <span class="va">head</span><span class="op">)</span></span>
<span><span class="co">#&gt; $lb</span></span>
<span><span class="co">#&gt;    stlevamf    stamflax    stdrpmat   efcroiveg efcroirepro      cgrain </span></span>
<span><span class="co">#&gt;      150.00      150.00      500.00        3.00        3.00        0.03 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $ub</span></span>
<span><span class="co">#&gt;    stlevamf    stamflax    stdrpmat   efcroiveg efcroirepro      cgrain </span></span>
<span><span class="co">#&gt;       4e+02       5e+02       9e+02       6e+00       6e+00       4e-02 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $default</span></span>
<span><span class="co">#&gt;    stlevamf    stamflax    stdrpmat   efcroiveg efcroirepro      cgrain </span></span>
<span><span class="co">#&gt;    324.8000    446.8000    820.0000      5.3000      3.5000      0.0324</span></span></code></pre></div>
<p>All information required to automate the protocol (parameter bounds
and default values) is stored in the <code>param_info</code> object.</p>
</div>
</div>
<div class="section level2">
<h2 id="running-the-protocol">Running the protocol<a class="anchor" aria-label="anchor" href="#running-the-protocol"></a>
</h2>
<p>Running the whole calibration protocol is done with a single call to
<code>run_protocol_agmip.</code></p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">res</span> <span class="op">&lt;-</span> <span class="fu">CroptimizR</span><span class="fu">::</span><span class="fu"><a href="../reference/run_protocol_agmip.html">run_protocol_agmip</a></span><span class="op">(</span></span>
<span>  obs_list <span class="op">=</span> <span class="va">obs_list</span>,</span>
<span>  model_function <span class="op">=</span> <span class="fu">SticsOnR</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/pkg/SticsOnR/man/stics_wrapper.html" class="external-link">stics_wrapper</a></span>,</span>
<span>  model_options <span class="op">=</span> <span class="va">model_options</span>,</span>
<span>  param_info <span class="op">=</span> <span class="va">param_info</span>,</span>
<span>  transform_var <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>masec_n <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">pmax</a></span><span class="op">(</span><span class="va">x</span>, <span class="fl">1e-6</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  step <span class="op">=</span> <span class="va">step</span></span>
<span><span class="op">)</span></span></code></pre></div>
<blockquote>
<p>Note that <code>run_protocol_agmip</code> includes many optional
arguments not illustrated here (constraints, transformations,
optimization settings, etc.). See
<code><a href="../reference/run_protocol_agmip.html">?CroptimizR::run_protocol_agmip</a></code> for details.</p>
</blockquote>
<p>Some model-specific initialization steps (construction of
<code>model_options</code> for the <code>stics_wrapper</code>) are not
shown here for the sake of brevity and because they are
model-dependent.</p>
<p>In this example, we illustrate the use of the optional
<code>transform_var</code> argument to apply a logarithmic
transformation to biomass observations (<code>masec_n</code>). Such
transformations are recommended when the variance of the errors is
assumed to be proportional to the magnitude of the variable. The
<code>pmax(x, 1e-6)</code> construction ensures that zero values are
replaced by a small positive number before applying the log, preventing
numerical errors.</p>
<p>During execution, the main steps of the protocol and associated
results are displayed in the console:</p>
<pre style="border:1px solid #ccc; padding:10px; max-height:300px; overflow:auto; background:#f8f8f8;"> AgMIP Calibration Phase IV protocol: automatic calculation steps 6 and 7
(see doi.org/10.1016/j.envsoft.2024.106147 for a detailed description of the full protocol)

-- Step6

---- Step6.phenology


------ Parameter automatic selection procedure: Step6.phenology.Major(s)

       Major parameter(s): stlevamf stamflax stdrpmat
       Estimated parameter(s): stlevamf stamflax stdrpmat
       Forced parameter(s): efcroiveg=  5.30000, efcroirepro=  3.50000, cgrain=  0.03240, vitircarbT=  0.00031, jvc= 58.36400, sensrsec=  0.80000, belong=  0.02280, jvcmini= 11.80000, stressdev=  0.60000, dlaimaxbrut=  0.00319, durvieF=260.00000, vlaimax=  2.38000, psisto= 12.60000, psiturg= 10.60000, nbjgrain= 36.00000, pgrainmaxi=  0.05528, cgrainv0=  0.04200
       Observed variable(s) used: iamfs, ilaxs, imats

Working: 10.00%. Estimated remaining time: 60.10 mins
Working: 20.00%. Estimated remaining time: 44.22 mins
Working: 30.00%. Estimated remaining time: 35.92 mins
Working: 40.00%. Estimated remaining time: 33.53 mins
Working: 50.00%. Estimated remaining time: 27.02 mins
Working: 60.00%. Estimated remaining time: 22.63 mins
Working: 70.00%. Estimated remaining time: 16.87 mins
Working: 80.00%. Estimated remaining time: 11.20 mins
Working: 90.00%. Estimated remaining time: 5.35 mins
Working: 100.00%. Estimated remaining time: 0.00 mins

       Estimated value for stlevamf: 192
       Estimated value for stamflax: 256
       Estimated value for stdrpmat: 500
       Minimum value of the criterion: 785
       Complementary graphs and results can be found in /storage/simple/projects/inra_ea/emmah/sbuis/AgMIP_calibration_Protocol_vignette/AgMIP_protocol_step6/Step6.phenology/param_select_step1

       Current value of the information criterion: 130

------ Parameter automatic selection procedure: Step6.phenology.Candidate1

       Major parameter(s): stlevamf stamflax stdrpmat
       Current candidate parameter evaluated: jvc
       Estimated parameter(s): stlevamf stamflax stdrpmat jvc
       Forced parameter(s): efcroiveg=  5.30000, efcroirepro=  3.50000, cgrain=  0.03240, vitircarbT=  0.00031, sensrsec=  0.80000, belong=  0.02280, jvcmini= 11.80000, stressdev=  0.60000, dlaimaxbrut=  0.00319, durvieF=260.00000, vlaimax=  2.38000, psisto= 12.60000, psiturg= 10.60000, nbjgrain= 36.00000, pgrainmaxi=  0.05528, cgrainv0=  0.04200
       Observed variable(s) used: iamfs, ilaxs, imats

Working: 20.00%. Estimated remaining time: 17.98 mins
Working: 40.00%. Estimated remaining time: 13.30 mins
Working: 60.00%. Estimated remaining time: 9.31 mins
Working: 80.00%. Estimated remaining time: 4.79 mins
Working: 100.00%. Estimated remaining time: 0.00 mins

       Estimated value for stlevamf: 210
       Estimated value for stamflax: 254
       Estimated value for stdrpmat: 500
       Estimated value for jvc: 36
       Minimum value of the criterion: 683
       Complementary graphs and results can be found in /storage/simple/projects/inra_ea/emmah/sbuis/AgMIP_calibration_Protocol_vignette/AgMIP_protocol_step6/Step6.phenology/param_select_step2

       Current value of the information criterion: 126
       Candidate parameter jvc is selected

------ Parameter automatic selection procedure: Step6.phenology.Candidate2

       Major parameter(s): stlevamf stamflax stdrpmat
       Current candidate parameter evaluated: sensrsec
       Estimated parameter(s): stlevamf stamflax stdrpmat jvc sensrsec
       Forced parameter(s): efcroiveg=  5.30000, efcroirepro=  3.50000, cgrain=  0.03240, vitircarbT=  0.00031, belong=  0.02280, jvcmini= 11.80000, stressdev=  0.60000, dlaimaxbrut=  0.00319, durvieF=260.00000, vlaimax=  2.38000, psisto= 12.60000, psiturg= 10.60000, nbjgrain= 36.00000, pgrainmaxi=  0.05528, cgrainv0=  0.04200
       Observed variable(s) used: iamfs, ilaxs, imats

Working: 20.00%. Estimated remaining time: 25.94 mins
Working: 40.00%. Estimated remaining time: 17.26 mins
Working: 60.00%. Estimated remaining time: 10.64 mins
Working: 80.00%. Estimated remaining time: 5.42 mins
Working: 100.00%. Estimated remaining time: 0.00 mins

       Estimated value for stlevamf: 216
       Estimated value for stamflax: 253
       Estimated value for stdrpmat: 500
       Estimated value for jvc: 28
       Estimated value for sensrsec: 0.91
       Minimum value of the criterion: 626
       Complementary graphs and results can be found in /storage/simple/projects/inra_ea/emmah/sbuis/AgMIP_calibration_Protocol_vignette/AgMIP_protocol_step6/Step6.phenology/param_select_step3

       Current value of the information criterion: 125
       Candidate parameter sensrsec is selected

------ Parameter automatic selection procedure: Step6.phenology.Candidate3

       Major parameter(s): stlevamf stamflax stdrpmat
       Current candidate parameter evaluated: belong
       Estimated parameter(s): stlevamf stamflax stdrpmat jvc sensrsec belong
       Forced parameter(s): efcroiveg=  5.30000, efcroirepro=  3.50000, cgrain=  0.03240, vitircarbT=  0.00031, jvcmini= 11.80000, stressdev=  0.60000, dlaimaxbrut=  0.00319, durvieF=260.00000, vlaimax=  2.38000, psisto= 12.60000, psiturg= 10.60000, nbjgrain= 36.00000, pgrainmaxi=  0.05528, cgrainv0=  0.04200
       Observed variable(s) used: iamfs, ilaxs, imats

Working: 20.00%. Estimated remaining time: 23.38 mins
Working: 40.00%. Estimated remaining time: 19.12 mins
Working: 60.00%. Estimated remaining time: 12.34 mins
Working: 80.00%. Estimated remaining time: 5.93 mins
Working: 100.00%. Estimated remaining time: 0.00 mins

       Estimated value for stlevamf: 216
       Estimated value for stamflax: 256
       Estimated value for stdrpmat: 500
       Estimated value for jvc: 29
       Estimated value for sensrsec: 0.98
       Estimated value for belong: 0.011
       Minimum value of the criterion: 616
       Complementary graphs and results can be found in /storage/simple/projects/inra_ea/emmah/sbuis/AgMIP_calibration_Protocol_vignette/AgMIP_protocol_step6/Step6.phenology/param_select_step4

       Current value of the information criterion: 127
       Candidate parameter belong is rejected

------ Parameter automatic selection procedure: Step6.phenology.Candidate4

       Major parameter(s): stlevamf stamflax stdrpmat
       Current candidate parameter evaluated: jvcmini
       Estimated parameter(s): stlevamf stamflax stdrpmat jvc sensrsec jvcmini
       Forced parameter(s): efcroiveg=  5.30000, efcroirepro=  3.50000, cgrain=  0.03240, vitircarbT=  0.00031, belong=  0.02280, stressdev=  0.60000, dlaimaxbrut=  0.00319, durvieF=260.00000, vlaimax=  2.38000, psisto= 12.60000, psiturg= 10.60000, nbjgrain= 36.00000, pgrainmaxi=  0.05528, cgrainv0=  0.04200
       Observed variable(s) used: iamfs, ilaxs, imats

Working: 20.00%. Estimated remaining time: 19.37 mins
Working: 40.00%. Estimated remaining time: 18.16 mins
Working: 60.00%. Estimated remaining time: 12.11 mins
Working: 80.00%. Estimated remaining time: 5.82 mins
Working: 100.00%. Estimated remaining time: 0.00 mins

       Estimated value for stlevamf: 230
       Estimated value for stamflax: 257
       Estimated value for stdrpmat: 503
       Estimated value for jvc: 29
       Estimated value for sensrsec: 0.94
       Estimated value for jvcmini: 3.4
       Minimum value of the criterion: 579
       Complementary graphs and results can be found in /storage/simple/projects/inra_ea/emmah/sbuis/AgMIP_calibration_Protocol_vignette/AgMIP_protocol_step6/Step6.phenology/param_select_step5

       Current value of the information criterion: 125
       Candidate parameter jvcmini is selected

------ Parameter automatic selection procedure: Step6.phenology.Candidate5

       Major parameter(s): stlevamf stamflax stdrpmat
       Current candidate parameter evaluated: stressdev
       Estimated parameter(s): stlevamf stamflax stdrpmat jvc sensrsec jvcmini stressdev
       Forced parameter(s): efcroiveg=  5.30000, efcroirepro=  3.50000, cgrain=  0.03240, vitircarbT=  0.00031, belong=  0.02280, dlaimaxbrut=  0.00319, durvieF=260.00000, vlaimax=  2.38000, psisto= 12.60000, psiturg= 10.60000, nbjgrain= 36.00000, pgrainmaxi=  0.05528, cgrainv0=  0.04200
       Observed variable(s) used: iamfs, ilaxs, imats

Working: 20.00%. Estimated remaining time: 34.43 mins
Working: 40.00%. Estimated remaining time: 24.73 mins
Working: 60.00%. Estimated remaining time: 18.72 mins
Working: 80.00%. Estimated remaining time: 9.16 mins
Working: 100.00%. Estimated remaining time: 0.00 mins

       Estimated value for stlevamf: 225
       Estimated value for stamflax: 277
       Estimated value for stdrpmat: 518
       Estimated value for jvc: 34
       Estimated value for sensrsec: 0.99
       Estimated value for jvcmini: 3.3
       Estimated value for stressdev: 0.51
       Minimum value of the criterion: 448
       Complementary graphs and results can be found in /storage/simple/projects/inra_ea/emmah/sbuis/AgMIP_calibration_Protocol_vignette/AgMIP_protocol_step6/Step6.phenology/param_select_step6

       Current value of the information criterion: 117
       Candidate parameter stressdev is selected

------ End of parameter selection procedure

---- Summary of the Parameter Selection procedure results

     Selected step:6
     Selected parameters: stlevamf,stamflax,stdrpmat,jvc,sensrsec,jvcmini,stressdev
     Estimated value for stlevamf: 224.72
     Estimated value for stamflax: 277.26
     Estimated value for stdrpmat: 517.96
     Estimated value for jvc: 34.37
     Estimated value for sensrsec: 0.99
     Estimated value for jvcmini: 3.35
     Estimated value for stressdev: 0.51
     Results of the parameter selection procedure are stored in /storage/simple/projects/inra_ea/emmah/sbuis/AgMIP_calibration_Protocol_vignette/AgMIP_protocol_step6/Step6.phenology/optim_results.Rdata
     A table summarizing the results obtained at the different steps is stored in /storage/simple/projects/inra_ea/emmah/sbuis/AgMIP_calibration_Protocol_vignette/AgMIP_protocol_step6/Step6.phenology/param_selection_steps.csv
     Graphs and detailed results obtained for the different parameter selection steps can be found in /storage/simple/projects/inra_ea/emmah/sbuis/AgMIP_calibration_Protocol_vignette/AgMIP_protocol_step6/Step6.phenology/param_select_step# folders.

---- End of Step Step6.phenology

---- Step6.plant_biomass


------ Parameter automatic selection procedure: Step6.plant_biomass.Major(s)

       Major parameter(s): efcroiveg efcroirepro
       Estimated parameter(s): efcroiveg efcroirepro
       Forced parameter(s): stlevamf=224.71943, stamflax=277.26244, stdrpmat=517.96341, jvc= 34.37244, sensrsec=  0.98633, jvcmini=  3.34810, stressdev=  0.51269, cgrain=  0.03240, vitircarbT=  0.00031, belong=  0.02280, dlaimaxbrut=  0.00319, durvieF=260.00000, vlaimax=  2.38000, psisto= 12.60000, psiturg= 10.60000, nbjgrain= 36.00000, pgrainmaxi=  0.05528, cgrainv0=  0.04200
       Observed variable(s) used: masec_n

Working: 10.00%. Estimated remaining time: 21.64 mins
Working: 20.00%. Estimated remaining time: 17.33 mins
Working: 30.00%. Estimated remaining time: 17.18 mins
Working: 40.00%. Estimated remaining time: 14.79 mins
Working: 50.00%. Estimated remaining time: 11.67 mins
Working: 60.00%. Estimated remaining time: 9.87 mins
Working: 70.00%. Estimated remaining time: 7.56 mins
Working: 80.00%. Estimated remaining time: 4.93 mins
Working: 90.00%. Estimated remaining time: 2.46 mins
Working: 100.00%. Estimated remaining time: 0.00 mins

       Estimated value for efcroiveg: 3
       Estimated value for efcroirepro: 4.3
       Minimum value of the criterion: 7.1
       Complementary graphs and results can be found in /storage/simple/projects/inra_ea/emmah/sbuis/AgMIP_calibration_Protocol_vignette/AgMIP_protocol_step6/Step6.plant_biomass/param_select_step1

       Current value of the information criterion: -76

------ Parameter automatic selection procedure: Step6.plant_biomass.Candidate1

       Major parameter(s): efcroiveg efcroirepro
       Current candidate parameter evaluated: dlaimaxbrut
       Estimated parameter(s): efcroiveg efcroirepro dlaimaxbrut
       Forced parameter(s): stlevamf=224.71943, stamflax=277.26244, stdrpmat=517.96341, jvc= 34.37244, sensrsec=  0.98633, jvcmini=  3.34810, stressdev=  0.51269, cgrain=  0.03240, vitircarbT=  0.00031, belong=  0.02280, durvieF=260.00000, vlaimax=  2.38000, psisto= 12.60000, psiturg= 10.60000, nbjgrain= 36.00000, pgrainmaxi=  0.05528, cgrainv0=  0.04200
       Observed variable(s) used: masec_n

Working: 20.00%. Estimated remaining time: 24.35 mins
Working: 40.00%. Estimated remaining time: 16.90 mins
Working: 60.00%. Estimated remaining time: 10.37 mins
Working: 80.00%. Estimated remaining time: 5.19 mins
Working: 100.00%. Estimated remaining time: 0.00 mins

       Estimated value for efcroiveg: 4.6
       Estimated value for efcroirepro: 4.2
       Estimated value for dlaimaxbrut: 0.00029
       Minimum value of the criterion: 0.82
       Complementary graphs and results can be found in /storage/simple/projects/inra_ea/emmah/sbuis/AgMIP_calibration_Protocol_vignette/AgMIP_protocol_step6/Step6.plant_biomass/param_select_step2

       Current value of the information criterion: -169
       Candidate parameter dlaimaxbrut is selected

------ Parameter automatic selection procedure: Step6.plant_biomass.Candidate2

       Major parameter(s): efcroiveg efcroirepro
       Current candidate parameter evaluated: durvieF
       Estimated parameter(s): efcroiveg efcroirepro dlaimaxbrut durvieF
       Forced parameter(s): stlevamf=224.71943, stamflax=277.26244, stdrpmat=517.96341, jvc= 34.37244, sensrsec=  0.98633, jvcmini=  3.34810, stressdev=  0.51269, cgrain=  0.03240, vitircarbT=  0.00031, belong=  0.02280, vlaimax=  2.38000, psisto= 12.60000, psiturg= 10.60000, nbjgrain= 36.00000, pgrainmaxi=  0.05528, cgrainv0=  0.04200
       Observed variable(s) used: masec_n

Working: 20.00%. Estimated remaining time: 20.23 mins
Working: 40.00%. Estimated remaining time: 18.50 mins
Working: 60.00%. Estimated remaining time: 12.44 mins
Working: 80.00%. Estimated remaining time: 6.10 mins
Working: 100.00%. Estimated remaining time: 0.00 mins

       Estimated value for efcroiveg: 4.6
       Estimated value for efcroirepro: 4.6
       Estimated value for dlaimaxbrut: 0.00029
       Estimated value for durvieF: 265
       Minimum value of the criterion: 0.82
       Complementary graphs and results can be found in /storage/simple/projects/inra_ea/emmah/sbuis/AgMIP_calibration_Protocol_vignette/AgMIP_protocol_step6/Step6.plant_biomass/param_select_step3

       Current value of the information criterion: -166
       Candidate parameter durvieF is rejected

------ Parameter automatic selection procedure: Step6.plant_biomass.Candidate3

       Major parameter(s): efcroiveg efcroirepro
       Current candidate parameter evaluated: vlaimax
       Estimated parameter(s): efcroiveg efcroirepro dlaimaxbrut vlaimax
       Forced parameter(s): stlevamf=224.71943, stamflax=277.26244, stdrpmat=517.96341, jvc= 34.37244, sensrsec=  0.98633, jvcmini=  3.34810, stressdev=  0.51269, cgrain=  0.03240, vitircarbT=  0.00031, belong=  0.02280, durvieF=260.00000, psisto= 12.60000, psiturg= 10.60000, nbjgrain= 36.00000, pgrainmaxi=  0.05528, cgrainv0=  0.04200
       Observed variable(s) used: masec_n

Working: 20.00%. Estimated remaining time: 28.14 mins
Working: 40.00%. Estimated remaining time: 19.31 mins
Working: 60.00%. Estimated remaining time: 15.82 mins
Working: 80.00%. Estimated remaining time: 7.44 mins
Working: 100.00%. Estimated remaining time: 0.00 mins

       Estimated value for efcroiveg: 4.5
       Estimated value for efcroirepro: 4.3
       Estimated value for dlaimaxbrut: 0.00031
       Estimated value for vlaimax: 2.5
       Minimum value of the criterion: 0.81
       Complementary graphs and results can be found in /storage/simple/projects/inra_ea/emmah/sbuis/AgMIP_calibration_Protocol_vignette/AgMIP_protocol_step6/Step6.plant_biomass/param_select_step4

       Current value of the information criterion: -167
       Candidate parameter vlaimax is rejected

------ Parameter automatic selection procedure: Step6.plant_biomass.Candidate4

       Major parameter(s): efcroiveg efcroirepro
       Current candidate parameter evaluated: psisto
       Estimated parameter(s): efcroiveg efcroirepro dlaimaxbrut psisto
       Forced parameter(s): stlevamf=224.71943, stamflax=277.26244, stdrpmat=517.96341, jvc= 34.37244, sensrsec=  0.98633, jvcmini=  3.34810, stressdev=  0.51269, cgrain=  0.03240, vitircarbT=  0.00031, belong=  0.02280, durvieF=260.00000, vlaimax=  2.38000, psiturg= 10.60000, nbjgrain= 36.00000, pgrainmaxi=  0.05528, cgrainv0=  0.04200
       Observed variable(s) used: masec_n

Working: 20.00%. Estimated remaining time: 34.45 mins
Working: 40.00%. Estimated remaining time: 23.67 mins
Working: 60.00%. Estimated remaining time: 15.43 mins
Working: 80.00%. Estimated remaining time: 7.46 mins
Working: 100.00%. Estimated remaining time: 0.00 mins

       Estimated value for efcroiveg: 4.6
       Estimated value for efcroirepro: 4.7
       Estimated value for dlaimaxbrut: 0.00029
       Estimated value for psisto: 11
       Minimum value of the criterion: 0.82
       Complementary graphs and results can be found in /storage/simple/projects/inra_ea/emmah/sbuis/AgMIP_calibration_Protocol_vignette/AgMIP_protocol_step6/Step6.plant_biomass/param_select_step5

       Current value of the information criterion: -166
       Candidate parameter psisto is rejected

------ Parameter automatic selection procedure: Step6.plant_biomass.Candidate5

       Major parameter(s): efcroiveg efcroirepro
       Current candidate parameter evaluated: psiturg
       Estimated parameter(s): efcroiveg efcroirepro dlaimaxbrut psiturg
       Forced parameter(s): stlevamf=224.71943, stamflax=277.26244, stdrpmat=517.96341, jvc= 34.37244, sensrsec=  0.98633, jvcmini=  3.34810, stressdev=  0.51269, cgrain=  0.03240, vitircarbT=  0.00031, belong=  0.02280, durvieF=260.00000, vlaimax=  2.38000, psisto= 12.60000, nbjgrain= 36.00000, pgrainmaxi=  0.05528, cgrainv0=  0.04200
       Observed variable(s) used: masec_n

Working: 20.00%. Estimated remaining time: 31.24 mins
Working: 40.00%. Estimated remaining time: 21.11 mins
Working: 60.00%. Estimated remaining time: 14.82 mins
Working: 80.00%. Estimated remaining time: 7.40 mins
Working: 100.00%. Estimated remaining time: 0.00 mins

       Estimated value for efcroiveg: 4.6
       Estimated value for efcroirepro: 4.5
       Estimated value for dlaimaxbrut: 0.00029
       Estimated value for psiturg: 2.1
       Minimum value of the criterion: 0.82
       Complementary graphs and results can be found in /storage/simple/projects/inra_ea/emmah/sbuis/AgMIP_calibration_Protocol_vignette/AgMIP_protocol_step6/Step6.plant_biomass/param_select_step6

       Current value of the information criterion: -166
       Candidate parameter psiturg is rejected

------ End of parameter selection procedure

---- Summary of the Parameter Selection procedure results

     Selected step:2
     Selected parameters: efcroiveg,efcroirepro,dlaimaxbrut
     Estimated value for efcroiveg: 4.62
     Estimated value for efcroirepro: 4.25
     Estimated value for dlaimaxbrut: 0.00029
     Results of the parameter selection procedure are stored in /storage/simple/projects/inra_ea/emmah/sbuis/AgMIP_calibration_Protocol_vignette/AgMIP_protocol_step6/Step6.plant_biomass/optim_results.Rdata
     A table summarizing the results obtained at the different steps is stored in /storage/simple/projects/inra_ea/emmah/sbuis/AgMIP_calibration_Protocol_vignette/AgMIP_protocol_step6/Step6.plant_biomass/param_selection_steps.csv
     Graphs and detailed results obtained for the different parameter selection steps can be found in /storage/simple/projects/inra_ea/emmah/sbuis/AgMIP_calibration_Protocol_vignette/AgMIP_protocol_step6/Step6.plant_biomass/param_select_step# folders.

---- End of Step Step6.plant_biomass

---- Step6.grain_number


------ Parameter automatic selection procedure: Step6.grain_number.Major(s)

       Major parameter(s): cgrain
       Estimated parameter(s): cgrain
       Forced parameter(s): stlevamf=224.71943, stamflax=277.26244, stdrpmat=517.96341, jvc= 34.37244, sensrsec=  0.98633, jvcmini=  3.34810, stressdev=  0.51269, efcroiveg=  4.61917, efcroirepro=  4.24638, dlaimaxbrut=  0.00029, vitircarbT=  0.00031, belong=  0.02280, durvieF=260.00000, vlaimax=  2.38000, psisto= 12.60000, psiturg= 10.60000, nbjgrain= 36.00000, pgrainmaxi=  0.05528, cgrainv0=  0.04200
       Observed variable(s) used: chargefruit

Working: 10.00%. Estimated remaining time: 12.72 mins
Working: 20.00%. Estimated remaining time: 11.29 mins
Working: 30.00%. Estimated remaining time: 9.88 mins
Working: 40.00%. Estimated remaining time: 8.47 mins
Working: 50.00%. Estimated remaining time: 7.54 mins
Working: 60.00%. Estimated remaining time: 5.97 mins
Working: 70.00%. Estimated remaining time: 4.50 mins
Working: 80.00%. Estimated remaining time: 2.97 mins
Working: 90.00%. Estimated remaining time: 1.51 mins
Working: 100.00%. Estimated remaining time: 0.00 mins

       Estimated value for cgrain: 0.035
       Minimum value of the criterion: 61347299
       Complementary graphs and results can be found in /storage/simple/projects/inra_ea/emmah/sbuis/AgMIP_calibration_Protocol_vignette/AgMIP_protocol_step6/Step6.grain_number/param_select_step1

       Current value of the information criterion: 202

------ Parameter automatic selection procedure: Step6.grain_number.Candidate1

       Major parameter(s): cgrain
       Current candidate parameter evaluated: nbjgrain
       Estimated parameter(s): cgrain nbjgrain
       Forced parameter(s): stlevamf=224.71943, stamflax=277.26244, stdrpmat=517.96341, jvc= 34.37244, sensrsec=  0.98633, jvcmini=  3.34810, stressdev=  0.51269, efcroiveg=  4.61917, efcroirepro=  4.24638, dlaimaxbrut=  0.00029, vitircarbT=  0.00031, belong=  0.02280, durvieF=260.00000, vlaimax=  2.38000, psisto= 12.60000, psiturg= 10.60000, pgrainmaxi=  0.05528, cgrainv0=  0.04200
       Observed variable(s) used: chargefruit

Working: 20.00%. Estimated remaining time: 12.97 mins
Working: 40.00%. Estimated remaining time: 10.53 mins
Working: 60.00%. Estimated remaining time: 6.91 mins
Working: 80.00%. Estimated remaining time: 3.31 mins
Working: 100.00%. Estimated remaining time: 0.00 mins

       Estimated value for cgrain: 0.034
       Estimated value for nbjgrain: 34
       Minimum value of the criterion: 60622215
       Complementary graphs and results can be found in /storage/simple/projects/inra_ea/emmah/sbuis/AgMIP_calibration_Protocol_vignette/AgMIP_protocol_step6/Step6.grain_number/param_select_step2

       Current value of the information criterion: 205
       Candidate parameter nbjgrain is rejected

------ End of parameter selection procedure

---- Summary of the Parameter Selection procedure results

     Selected step:1
     Selected parameters: cgrain
     Estimated value for cgrain: 0.035
     Results of the parameter selection procedure are stored in /storage/simple/projects/inra_ea/emmah/sbuis/AgMIP_calibration_Protocol_vignette/AgMIP_protocol_step6/Step6.grain_number/optim_results.Rdata
     A table summarizing the results obtained at the different steps is stored in /storage/simple/projects/inra_ea/emmah/sbuis/AgMIP_calibration_Protocol_vignette/AgMIP_protocol_step6/Step6.grain_number/param_selection_steps.csv
     Graphs and detailed results obtained for the different parameter selection steps can be found in /storage/simple/projects/inra_ea/emmah/sbuis/AgMIP_calibration_Protocol_vignette/AgMIP_protocol_step6/Step6.grain_number/param_select_step# folders.

---- End of Step Step6.grain_number

---- Step6.yield


------ Parameter automatic selection procedure: Step6.yield.Major(s)

       Major parameter(s): vitircarbT
       Estimated parameter(s): vitircarbT
       Forced parameter(s): stlevamf=224.71943, stamflax=277.26244, stdrpmat=517.96341, jvc= 34.37244, sensrsec=  0.98633, jvcmini=  3.34810, stressdev=  0.51269, efcroiveg=  4.61917, efcroirepro=  4.24638, dlaimaxbrut=  0.00029, cgrain=  0.03496, belong=  0.02280, durvieF=260.00000, vlaimax=  2.38000, psisto= 12.60000, psiturg= 10.60000, nbjgrain= 36.00000, pgrainmaxi=  0.05528, cgrainv0=  0.04200
       Observed variable(s) used: mafruit

Working: 10.00%. Estimated remaining time: 13.81 mins
Working: 20.00%. Estimated remaining time: 11.79 mins
Working: 30.00%. Estimated remaining time: 11.27 mins
Working: 40.00%. Estimated remaining time: 9.71 mins
Working: 50.00%. Estimated remaining time: 7.94 mins
Working: 60.00%. Estimated remaining time: 5.45 mins
Working: 70.00%. Estimated remaining time: 4.34 mins
Working: 80.00%. Estimated remaining time: 3.08 mins
Working: 90.00%. Estimated remaining time: 1.39 mins
Working: 100.00%. Estimated remaining time: 0.00 mins

       Estimated value for vitircarbT: 0.0009
       Minimum value of the criterion: 27
       Complementary graphs and results can be found in /storage/simple/projects/inra_ea/emmah/sbuis/AgMIP_calibration_Protocol_vignette/AgMIP_protocol_step6/Step6.yield/param_select_step1

       Current value of the information criterion: 12

------ Parameter automatic selection procedure: Step6.yield.Candidate1

       Major parameter(s): vitircarbT
       Current candidate parameter evaluated: pgrainmaxi
       Estimated parameter(s): vitircarbT pgrainmaxi
       Forced parameter(s): stlevamf=224.71943, stamflax=277.26244, stdrpmat=517.96341, jvc= 34.37244, sensrsec=  0.98633, jvcmini=  3.34810, stressdev=  0.51269, efcroiveg=  4.61917, efcroirepro=  4.24638, dlaimaxbrut=  0.00029, cgrain=  0.03496, belong=  0.02280, durvieF=260.00000, vlaimax=  2.38000, psisto= 12.60000, psiturg= 10.60000, nbjgrain= 36.00000, cgrainv0=  0.04200
       Observed variable(s) used: mafruit

Working: 20.00%. Estimated remaining time: 6.80 mins
Working: 40.00%. Estimated remaining time: 8.91 mins
Working: 60.00%. Estimated remaining time: 6.54 mins
Working: 80.00%. Estimated remaining time: 2.88 mins
Working: 100.00%. Estimated remaining time: 0.00 mins

       Estimated value for vitircarbT: 0.00095
       Estimated value for pgrainmaxi: 0.039
       Minimum value of the criterion: 22
       Complementary graphs and results can be found in /storage/simple/projects/inra_ea/emmah/sbuis/AgMIP_calibration_Protocol_vignette/AgMIP_protocol_step6/Step6.yield/param_select_step2

       Current value of the information criterion: 12
       Candidate parameter pgrainmaxi is rejected

------ Parameter automatic selection procedure: Step6.yield.Candidate2

       Major parameter(s): vitircarbT
       Current candidate parameter evaluated: cgrainv0
       Estimated parameter(s): vitircarbT cgrainv0
       Forced parameter(s): stlevamf=224.71943, stamflax=277.26244, stdrpmat=517.96341, jvc= 34.37244, sensrsec=  0.98633, jvcmini=  3.34810, stressdev=  0.51269, efcroiveg=  4.61917, efcroirepro=  4.24638, dlaimaxbrut=  0.00029, cgrain=  0.03496, belong=  0.02280, durvieF=260.00000, vlaimax=  2.38000, psisto= 12.60000, psiturg= 10.60000, nbjgrain= 36.00000, pgrainmaxi=  0.05528
       Observed variable(s) used: mafruit

Working: 20.00%. Estimated remaining time: 6.93 mins
Working: 40.00%. Estimated remaining time: 5.21 mins
Working: 60.00%. Estimated remaining time: 3.46 mins
Working: 80.00%. Estimated remaining time: 1.73 mins
Working: 100.00%. Estimated remaining time: 0.00 mins

       Estimated value for vitircarbT: 0.0009
       Estimated value for cgrainv0: 0.046
       Minimum value of the criterion: 27
       Complementary graphs and results can be found in /storage/simple/projects/inra_ea/emmah/sbuis/AgMIP_calibration_Protocol_vignette/AgMIP_protocol_step6/Step6.yield/param_select_step3

       Current value of the information criterion: 15
       Candidate parameter cgrainv0 is rejected

------ End of parameter selection procedure

---- Summary of the Parameter Selection procedure results

     Selected step:1
     Selected parameters: vitircarbT
     Estimated value for vitircarbT: 0.0009
     Results of the parameter selection procedure are stored in /storage/simple/projects/inra_ea/emmah/sbuis/AgMIP_calibration_Protocol_vignette/AgMIP_protocol_step6/Step6.yield/optim_results.Rdata
     A table summarizing the results obtained at the different steps is stored in /storage/simple/projects/inra_ea/emmah/sbuis/AgMIP_calibration_Protocol_vignette/AgMIP_protocol_step6/Step6.yield/param_selection_steps.csv
     Graphs and detailed results obtained for the different parameter selection steps can be found in /storage/simple/projects/inra_ea/emmah/sbuis/AgMIP_calibration_Protocol_vignette/AgMIP_protocol_step6/Step6.yield/param_select_step# folders.

---- End of Step Step6.yield

-- Summary of the multi-step procedure results

   List of observed variables used: iamfs, ilaxs, imats, masec_n, chargefruit, mafruit
   Estimated value for stlevamf: 225
   Estimated value for stamflax: 277
   Estimated value for stdrpmat: 518
   Estimated value for jvc: 34
   Estimated value for sensrsec: 0.99
   Estimated value for jvcmini: 3.3
   Estimated value for stressdev: 0.51
   Estimated value for efcroiveg: 4.6
   Estimated value for efcroirepro: 4.2
   Estimated value for dlaimaxbrut: 0.00029
   Estimated value for cgrain: 0.035
   Estimated value for vitircarbT: 0.0009
   Forced value for belong: 0.023
   Forced value for durvieF: 260
   Forced value for vlaimax: 2.4
   Forced value for psisto: 13
   Forced value for psiturg: 11
   Forced value for nbjgrain: 36
   Forced value for pgrainmaxi: 0.055
   Forced value for cgrainv0: 0.042
   Complementary graphs and results can be found in /storage/simple/projects/inra_ea/emmah/sbuis/AgMIP_calibration_Protocol_vignette/AgMIP_protocol_step6

   Average time for the model to simulate all required situations: 3.4sec elapsed
   Total number of criterion evaluation: 8349
   Total time of model simulations: 28085sec elapsed
   Total time of parameter estimation procedure: 28451sec elapsed

-- End of Step6

-- Step7

   Estimated parameter(s): stlevamf stamflax stdrpmat jvc sensrsec jvcmini stressdev efcroiveg efcroirepro dlaimaxbrut cgrain vitircarbT
   Forced parameter(s): belong=  0.023, durvieF=260.000, vlaimax=  2.380, psisto= 12.600, psiturg= 10.600, nbjgrain= 36.000, pgrainmaxi=  0.055, cgrainv0=  0.042
   Observed variable(s) used: iamfs, ilaxs, imats, masec_n, chargefruit, mafruit

Working: 5.00%. Estimated remaining time: 34.16 hours
Working: 10.00%. Estimated remaining time: 43.33 hours
Working: 15.00%. Estimated remaining time: 45.86 hours
Working: 20.00%. Estimated remaining time: 47.27 hours
Working: 25.00%. Estimated remaining time: 41.94 hours
Working: 30.00%. Estimated remaining time: 38.60 hours
Working: 35.00%. Estimated remaining time: 35.64 hours
Working: 40.00%. Estimated remaining time: 32.64 hours
Working: 45.00%. Estimated remaining time: 1.24 days
Working: 50.00%. Estimated remaining time: 1.11 days
Working: 55.00%. Estimated remaining time: 1.02 days
Working: 60.00%. Estimated remaining time: 0.91 days
Working: 65.00%. Estimated remaining time: 0.79 days
Working: 70.00%. Estimated remaining time: 0.68 days
Working: 75.00%. Estimated remaining time: 0.55 days
Working: 80.00%. Estimated remaining time: 0.44 days
Working: 85.00%. Estimated remaining time: 0.32 days
Working: 90.00%. Estimated remaining time: 0.21 days
Working: 95.00%. Estimated remaining time: 0.11 days
Working: 100.00%. Estimated remaining time: 0.00 days

   Estimated value for stlevamf: 208
   Estimated value for stamflax: 346
   Estimated value for stdrpmat: 685
   Estimated value for jvc: 58
   Estimated value for sensrsec: 0.39
   Estimated value for jvcmini: 4.7
   Estimated value for stressdev: 0.12
   Estimated value for efcroiveg: 3.6
   Estimated value for efcroirepro: 4.8
   Estimated value for dlaimaxbrut: 0.00058
   Estimated value for cgrain: 0.039
   Estimated value for vitircarbT: 0.00064
   Minimum value of the criterion: 63
   Complementary graphs and results can be found in /storage/simple/projects/inra_ea/emmah/sbuis/AgMIP_calibration_Protocol_vignette/AgMIP_protocol_step7

   Average time for the model to simulate all required situations: 20sec elapsed
   Total number of criterion evaluation: 8995
   Total time of model simulations: 182491sec elapsed
   Total time of parameter estimation procedure: 183271sec elapsed

-- End of Step7

Graphs and results can be found in /storage/simple/projects/inra_ea/emmah/sbuis/AgMIP_calibration_Protocol_vignette

End of AgMIP Phase IV protocol
 </pre>
</div>
<div class="section level2">
<h2 id="exploring-the-results">Exploring the results<a class="anchor" aria-label="anchor" href="#exploring-the-results"></a>
</h2>
<p><code>run_protocol_agmip</code> returns a single structured R object
that provides a compact, structured summary of the calibration protocol
results.</p>
<p>However, the function also produces a large number of additional
outputs on disk, in the directory specified by the <code>out_dir</code>
argument (equal to <code><a href="https://rdrr.io/r/base/getwd.html" class="external-link">getwd()</a></code> by default). These files
contain, in particular, the full outputs of all calls to
<code>estim_param</code> performed during Step 6 and Step 7 (including
detailed optimization traces, diagnostics, details on parameter
selection steps, and intermediate results for each individual
minimization).</p>
<p>The returned R object is designed to give direct programmatic access
to the main results of the protocol, while the output directory ensures
full description of the results obtained.</p>
<p>Readers can refer to the
<code>system.file("extdata", "AgMIP_protocol", "results", package = "CroptimizR")</code>
folder to explore all the results saved on disk by
<code>run_protocol_agmip</code> for this example.</p>
<div class="section level3">
<h3 id="global-structure-of-the-returned-object">Global structure of the returned object<a class="anchor" aria-label="anchor" href="#global-structure-of-the-returned-object"></a>
</h3>
<p>The main components of the returned R object are:</p>
<ul>
<li>
<code>final_values</code>: final estimated parameter values,</li>
</ul>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">res</span><span class="op">$</span><span class="va">final_values</span><span class="op">)</span></span>
<span><span class="co">#&gt;    stlevamf    stamflax    stdrpmat         jvc    sensrsec     jvcmini </span></span>
<span><span class="co">#&gt; 208.0985918 346.1809368 684.9804296  58.0940869   0.3910102   4.7329535</span></span></code></pre></div>
<ul>
<li>
<code>forced_param_values</code>: values of parameters that are
fixed during the final calibration step (step 7), including non-selected
candidate parameters and parameters explicitly fixed in the protocol via
the <code>forced_param_values</code> input argument.</li>
</ul>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">res</span><span class="op">$</span><span class="va">forced_param_values</span><span class="op">)</span></span>
<span><span class="co">#&gt;   belong  durvieF  vlaimax   psisto  psiturg nbjgrain </span></span>
<span><span class="co">#&gt;   0.0228 260.0000   2.3800  12.6000  10.6000  36.0000</span></span></code></pre></div>
<ul>
<li>
<code>obs_var_list</code>: observed variables used for
calibration,</li>
</ul>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">res</span><span class="op">$</span><span class="va">obs_var_list</span></span>
<span><span class="co">#&gt; [1] "iamfs"       "ilaxs"       "imats"       "chargefruit" "mafruit"    </span></span>
<span><span class="co">#&gt; [6] "masec_n"</span></span></code></pre></div>
<ul>
<li>
<code>values_per_step</code>: parameter values after each step,</li>
</ul>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">res</span><span class="op">$</span><span class="va">values_per_step</span><span class="op">)</span></span>
<span><span class="co">#&gt;       name default       step6       step7</span></span>
<span><span class="co">#&gt; 1 stlevamf 324.800 224.7194314 208.0985918</span></span>
<span><span class="co">#&gt; 2 stamflax 446.800 277.2624366 346.1809368</span></span>
<span><span class="co">#&gt; 3 stdrpmat 820.000 517.9634083 684.9804296</span></span>
<span><span class="co">#&gt; 4      jvc  58.364  34.3724403  58.0940869</span></span>
<span><span class="co">#&gt; 5 sensrsec   0.800   0.9863296   0.3910102</span></span>
<span><span class="co">#&gt; 6  jvcmini  11.800   3.3481046   4.7329535</span></span></code></pre></div>
<ul>
<li>
<code>stats_per_step</code>: fit statistics for each variable and
each step,</li>
</ul>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">res</span><span class="op">$</span><span class="va">stats_per_step</span><span class="op">)</span></span>
<span><span class="co">#&gt;                  step    variable        Bias2      MSE     rRMSE         EF</span></span>
<span><span class="co">#&gt; 1             Default chargefruit 2.871521e+07 38855376 0.2939773 -1.6738864</span></span>
<span><span class="co">#&gt; 2     Step6.phenology chargefruit 2.732721e+07 35546572 0.2811817 -1.4461865</span></span>
<span><span class="co">#&gt; 3 Step6.plant_biomass chargefruit 2.189813e+06  6907875 0.1239540  0.5246250</span></span>
<span><span class="co">#&gt; 4  Step6.grain_number chargefruit 4.143539e+02  4719023 0.1024505  0.6752539</span></span>
<span><span class="co">#&gt; 5         Step6.yield chargefruit 4.143539e+02  4719023 0.1024505  0.6752539</span></span>
<span><span class="co">#&gt; 6               Step7 chargefruit 1.814333e+05  5119747 0.1067118  0.6476776</span></span></code></pre></div>
<ul>
<li>
<code>step6</code>, <code>step7</code>: detailed results for each
part of the protocol.</li>
</ul>
</div>
<div class="section level3">
<h3 id="exploring-parameter-selection-results-step-6">Exploring parameter selection results (Step 6)<a class="anchor" aria-label="anchor" href="#exploring-parameter-selection-results-step-6"></a>
</h3>
<p>During Step 6, a parameter selection procedure is applied
independently within each sub-step of the protocol for which candidate
parameters have been specified. Detailed information on this process is
available both in the R object returned by run_protocol_agmip and in the
outputs written to disk.</p>
<p>Within the returned object, parameter selection details can be
accessed via the <code>param_selection_steps</code> element of each Step
6 sub-step,
i.e. <code>res$step6$Step6.***$param_selection_steps</code>.</p>
<p>This element records the successive stages of the selection
procedure, including the parameters retained or discarded at each stage,
together with the associated intermediate results.</p>
For this example,
<code>res$step6$Step6.phenology$param_selection_steps</code> contains:
<div style="font-size: 0.8em;">
<table class="table">
<colgroup>
<col width="27%">
<col width="22%">
<col width="20%">
<col width="11%">
<col width="10%">
<col width="2%">
<col width="5%">
</colgroup>
<thead><tr class="header">
<th align="left">Estimated.parameters</th>
<th align="left">Initial.parameter.values</th>
<th align="left">Final.values</th>
<th align="right">Initial.Sum.of.squared.errors</th>
<th align="right">Final.Sum.of.squared.errors</th>
<th align="right">AICc</th>
<th align="left">Selected.step</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">stlevamf, stamflax, stdrpmat</td>
<td align="left">324.80, 446.80, 820.00</td>
<td align="left">192.06, 255.53, 500.00</td>
<td align="right">27184</td>
<td align="right">785</td>
<td align="right">129.61</td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left">stlevamf, stamflax, stdrpmat, jvc</td>
<td align="left">192.06, 255.53, 500.00, 32.99</td>
<td align="left">209.94, 253.51, 500.00, 35.82</td>
<td align="right">1161</td>
<td align="right">683</td>
<td align="right">126.21</td>
<td align="left"></td>
</tr>
<tr class="odd">
<td align="left">stlevamf, stamflax, stdrpmat, jvc , sensrsec</td>
<td align="left">209.94, 253.51, 500.00, 35.82, 0.47</td>
<td align="left">216.50, 253.14, 500.00, 27.52, 0.91</td>
<td align="right">722</td>
<td align="right">626</td>
<td align="right">125.14</td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left">stlevamf, stamflax, stdrpmat, jvc , sensrsec,
belong</td>
<td align="left">216.498, 253.139, 500.000, 27.517, 0.912, 0.011</td>
<td align="left">215.784, 256.069, 500.000, 29.067, 0.984, 0.011</td>
<td align="right">662</td>
<td align="right">616</td>
<td align="right">127.19</td>
<td align="left"></td>
</tr>
<tr class="odd">
<td align="left">stlevamf, stamflax, stdrpmat, jvc , sensrsec,
jvcmini</td>
<td align="left">216.50, 253.14, 500.00, 27.52, 0.91, 3.26</td>
<td align="left">230.01, 257.10, 503.11, 28.81, 0.94, 3.36</td>
<td align="right">868</td>
<td align="right">579</td>
<td align="right">124.59</td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left">stlevamf , stamflax , stdrpmat , jvc , sensrsec ,
jvcmini , stressdev</td>
<td align="left">230.009, 257.102, 503.108, 28.811, 0.938, 3.357,
0.062</td>
<td align="left">224.72, 277.26, 517.96, 34.37, 0.99, 3.35, 0.51</td>
<td align="right">4704</td>
<td align="right">448</td>
<td align="right">116.71</td>
<td align="left">X</td>
</tr>
</tbody>
</table>
</div>
<p>Note that, for the sake of brevity, only the initial and final values
of the repetition that produced the lowest criterion are stored in this
table.</p>
<p>The same information is also saved to disk as CSV files, with one
file per Step 6 sub-step, located in
<code>out_dir/Step6.***/param_selection_steps.csv</code>. Detailed
results from all parameter estimations conducted during the selection
procedure are stored in the directories
<code>out_dir/Step6.***/param_select_step*</code>. For this vignette,
<code>out_dir</code> corresponds to
<code>system.file("extdata", "AgMIP_protocol", "results", package = "CroptimizR")</code>.</p>
</div>
<div class="section level3">
<h3 id="built-in-diagnostics-plots">Built-in diagnostics plots<a class="anchor" aria-label="anchor" href="#built-in-diagnostics-plots"></a>
</h3>
<p>Several diagnostic plots are automatically generated and saved to
disk in the files <code>plot_MSE_Bias2_per_step.pdf</code> and
<code>scatter_plots_*.pdf</code>.</p>
<p><code>plot_MSE_Bias2_per_step.pdf</code> shows the evolution of the
mean squared error (MSE) and bias² for each observed variable across the
different steps of the protocol. We can check that the performance of a
variable is not degraded after it has been used in a step. In this
example, this holds for almost all variables, except <code>imats</code>,
for which bias² and MSE are affected in the <code>plant_biomass</code>
step. Note, however, that step 7 corrects this effect. The graph also
illustrates that bias² and MSE are substantially reduced compared to the
values obtained using the default parameter settings.</p>
<p><img src="../../../../../../private/var/folders/yz/zr09txvs5dn18vt4cn21kzl40000gn/T/RtmpInvDaS/temp_libpath2dab3b013723/CroptimizR/extdata/AgMIP_protocol/vignette_data/plot_MSE_Bias2_per_step.png" class="r-plt" alt="" width="90%"></p>
<p>The files <code>scatter_plots_*.pdf</code> contain scatter plots of
simulated versus observed variables after each protocol step, allowing a
closer inspection of the effect of each step. Here, we display the first
page of the <code>scatter_plots_step7.pdf</code> file, which shows the
results obtained at the end of the protocol for this example for
variables <code>iamfs</code>, <code>ilaxs</code>, <code>imats</code> and
<code>masec_n</code>.</p>
<p><img src="../../../../../../private/var/folders/yz/zr09txvs5dn18vt4cn21kzl40000gn/T/RtmpInvDaS/temp_libpath2dab3b013723/CroptimizR/extdata/AgMIP_protocol/vignette_data/scatter_plots_after_step7.png" class="r-plt" alt="" width="90%"></p>
</div>
</div>
<div class="section level2">
<h2 id="evaluating-the-results-on-an-independent-dataset">Evaluating the results on an independent dataset<a class="anchor" aria-label="anchor" href="#evaluating-the-results-on-an-independent-dataset"></a>
</h2>
<p>The calibrated model can then be evaluated on an independent dataset
(here, the 8 evaluation situations) using the model wrapper function and
the results provided by <code>run_protocol_agmip</code>.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Load observations for evaluation for our example</span></span>
<span><span class="va">obs_eval</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">readRDS</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"AgMIP_protocol"</span>, <span class="st">"vignette_data"</span><span class="op">)</span>,</span>
<span>  package <span class="op">=</span> <span class="st">"CroptimizR"</span></span>
<span><span class="op">)</span>, <span class="st">"obs_eval.Rds"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Get the names of the evaluation situations</span></span>
<span><span class="va">situations_eval</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">obs_eval</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Run the model on the evaluation situations using the default and then the estimated parameter values</span></span>
<span><span class="va">sim_before_calib</span> <span class="op">&lt;-</span> <span class="fu">SticsOnR</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/SticsOnR/man/stics_wrapper.html" class="external-link">stics_wrapper</a></span><span class="op">(</span></span>
<span>  param_values <span class="op">=</span> <span class="va">param_info</span><span class="op">$</span><span class="va">default</span>,</span>
<span>  model_options <span class="op">=</span> <span class="va">model_options</span>,</span>
<span>  situation <span class="op">=</span> <span class="va">situations_eval</span></span>
<span><span class="op">)</span></span>
<span><span class="va">sim_post_calib</span> <span class="op">&lt;-</span> <span class="fu">SticsOnR</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/SticsOnR/man/stics_wrapper.html" class="external-link">stics_wrapper</a></span><span class="op">(</span></span>
<span>  param_values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">res</span><span class="op">$</span><span class="va">final_values</span>, <span class="va">res</span><span class="op">$</span><span class="va">forced_param_values</span><span class="op">)</span>,</span>
<span>  model_options <span class="op">=</span> <span class="va">model_options</span>,</span>
<span>  situation <span class="op">=</span> <span class="va">situations_eval</span></span>
<span><span class="op">)</span></span></code></pre></div>
<blockquote>
<p>Note the use of <code>res$forced_param_values</code>, which includes
the default values of non-selected candidate parameters, whereas
<code>param_info$default</code> contains default values for all
parameters.</p>
</blockquote>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/SticsRPacks/CroPlotR" class="external-link">CroPlotR</a></span><span class="op">)</span></span>
<span><span class="co"># Compare rRMSE obtained with default and estimated values of the parameters using CroPlotR</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span>before_cal <span class="op">=</span> <span class="va">sim_before_calib</span><span class="op">$</span><span class="va">sim_list</span>, post_cal <span class="op">=</span> <span class="va">sim_post_calib</span><span class="op">$</span><span class="va">sim_list</span>, obs <span class="op">=</span> <span class="va">obs_eval</span>, stat <span class="op">=</span> <span class="st">"rRMSE"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="AgMIP_Calibration_Protocol_files/figure-html/unnamed-chunk-10-1.png" class="r-plt" alt="" width="768"></p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Compare observations and simulations, obtained with default and estimated values of the parameters, on scatter plots, using CroPlotR</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span>before_cal <span class="op">=</span> <span class="va">sim_before_calib</span><span class="op">$</span><span class="va">sim_list</span>, post_cal <span class="op">=</span> <span class="va">sim_post_calib</span><span class="op">$</span><span class="va">sim_list</span>, obs <span class="op">=</span> <span class="va">obs_eval</span>, type <span class="op">=</span> <span class="st">"scatter"</span><span class="op">)</span></span>
<span><span class="co">#&gt; $all_situations</span></span></code></pre></div>
<p><img src="AgMIP_Calibration_Protocol_files/figure-html/unnamed-chunk-10-2.png" class="r-plt" alt="" width="768"></p>
<p>This allows us to assess whether calibration improves predictive
performance on the evaluation dataset compared to the default parameter
values. This is indeed the case here, particularly for phenology and
biomass-related variables, while yield shows a more moderate but still
consistent improvement.</p>
</div>
<div class="section level2">
<h2 id="conclusion">Conclusion<a class="anchor" aria-label="anchor" href="#conclusion"></a>
</h2>
<p>This vignette illustrates how the AgMIP calibration protocol can be
fully automated in CroptimizR using a compact and explicit protocol
description. The same approach can be applied to other crop models and
datasets, provided that a suitable wrapper and protocol specification
are available.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

      </div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Samuel Buis, Patrice Lecharpentier, Remi Vezy, Michel Giner.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

      </footer>
</div>






  </body>
</html>
