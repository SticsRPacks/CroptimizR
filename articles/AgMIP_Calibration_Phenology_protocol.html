<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Estimating phenology following AgMIP-calibration phase III protocol • CroptimizR</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Estimating phenology following AgMIP-calibration phase III protocol">
<meta property="og:description" content="CroptimizR">
<meta property="og:image" content="/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">CroptimizR</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.6.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../articles/CroptimizR.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/Available_parameter_estimation_algorithms.html">Available parameter estimation algorithms in CroptimizR</a>
    </li>
    <li>
      <a href="../articles/Designing_a_model_wrapper.html">Guidelines for implementing a crop model R wrapper for CroptimizR</a>
    </li>
    <li>
      <a href="../articles/Parameter_estimation_simple_case.html">Parameter estimation with the Stics crop Model: a simple case</a>
    </li>
    <li>
      <a href="../articles/AgMIP_Calibration_Phenology_protocol.html">Estimating phenology following AgMIP-calibration phase III protocol</a>
    </li>
    <li>
      <a href="../articles/Parameter_estimation_Specific_and_Varietal.html">Parameter estimation with the Stics crop Model: a case with specific and varietal parameters</a>
    </li>
    <li>
      <a href="../articles/ApsimX_parameter_estimation_simple_case.html">Parameter estimation with the ApsimX crop Model: a simple case</a>
    </li>
    <li>
      <a href="../articles/Parameter_estimation_DREAM.html">Parameter estimation with the DREAM-zs algorithm</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/SticsRPacks/CroptimizR/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Estimating phenology following AgMIP-calibration
phase III protocol</h1>
                        <h4 data-toc-skip class="author">Samuel
Buis</h4>
                        
            <h4 data-toc-skip class="date">2023-12-22</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/SticsRPacks/CroptimizR/blob/HEAD/vignettes/AgMIP_Calibration_Phenology_protocol.Rmd" class="external-link"><code>vignettes/AgMIP_Calibration_Phenology_protocol.Rmd</code></a></small>
      <div class="hidden name"><code>AgMIP_Calibration_Phenology_protocol.Rmd</code></div>

    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>This document presents how the AgMIP phase III protocol, designed to
calibrate phenology of crop models, can be easily implemented using
CroptimizR and CroPlotR packages.</p>
<p>This protocol is described in detail in <a href="https://www.biorxiv.org/content/10.1101/2022.06.08.495355v1" class="external-link">Wallach
et al (2022)</a>.</p>
<p>Its objective is to improve crop model parameters values using
calibration for prediction of crop phenology.</p>
<p>Here is a brief description of its different steps:</p>
<ul>
<li>Define the default values for all parameters that impact the
simulation of phenology in the considered crop model.</li>
<li>Identify measured variables (phenological stages) to be fit within
the dataset available.</li>
<li>Identify the nearly additive, obligatory parameters to be
calibrated. The obligatory parameters are parameters that are nearly
additive, i.e. such that changing the parameter has a similar effect for
all environments (typically parameters that control degree days to the
measured stages). Ideally, the number of almost additive parameters will
be identical to the number of measured variables used. These parameters
will be estimated at each stage of the parameter estimation process.
Their estimation should lead to the elimination of bias between measured
and estimated phenological stages.</li>
<li>Identify candidate parameters to be calibrated. The role of the
candidate parameters is to reduce the variability between environments
that remains after estimation of the obligatory parameters.</li>
<li>Calculate the optimal parameter values. A model selection algorithm
is used to decide which parameters to estimate. First, all obligatory
parameters are estimated. Then, each candidate parameter is added in
turn to the list of estimated parameters, and only those that lead to a
reduction of a model selection criterion (BIC) are retained for
estimation. Otherwise, the parameter is kept at its default value. Each
set of parameters are estimated by minimizing an Ordinary Least Square
criterion (sum of squared differences between measured and simulated
phenological stages considered on all the environments). The
minimizations are performed using the Nelder-Mead simplex algorithm and
repeated from multiple (randomly chosen or given) starting points. At
the end, the parameters values resulting from the calibration process
are the estimated and default values of the parameters that lead to the
lowest value of the BIC criterion.</li>
</ul>
</div>
<div class="section level2">
<h2 id="study-case">Study Case<a class="anchor" aria-label="anchor" href="#study-case"></a>
</h2>
<p>The crop model input data used in this example comes from a maize
crop experiment (see description in <a href="https://www.sciencedirect.com/science/article/pii/S1364815210002574" class="external-link">Wallach
et al., 2011</a>). To illustrate the calibration procedure, julian days
of two phenological stages were simulated from this dataset on 8
different environments (called situations in CroptimizR language) and
then used as observations, after adding some random errors.</p>
<p>The STICS crop model is used in this example. Initialization steps
required by the use of this model (definition of the
<code>model_options</code> argument of the <code>estim_param</code>
function) are hidden in this example for sake of brevity. They are
detailed in the vignette (<a href="https://SticsRPacks.github.io/CroptimizR/articles/Parameter_estimation_simple_case.html" class="external-link uri">https://SticsRPacks.github.io/CroptimizR/articles/Parameter_estimation_simple_case.html</a>).</p>
</div>
<div class="section level2">
<h2 id="plotting-the-observations">Plotting the observations<a class="anchor" aria-label="anchor" href="#plotting-the-observations"></a>
</h2>
<p>The observations are provided here in the <code>obs_list</code>
object, in the format required by CroptimizR, i.e. a named list of
data.frame.</p>
<p>In this example, the variables corresponding to the two observed
stages considered are called “iamfs” and “ilaxs”. They correspond to the
julian days (from the beginning of the sowing year) of “end juvenile”
and “maximum LAI” stages as defined in the STICS crop model.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">obs_list</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## $`bo96iN+`</span></span>
<span><span class="co">##         Date iamfs ilaxs</span></span>
<span><span class="co">## 1 1996-10-15   168   230</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $bou00t1</span></span>
<span><span class="co">##         Date iamfs ilaxs</span></span>
<span><span class="co">## 1 2000-11-01   181   221</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $bou00t3</span></span>
<span><span class="co">##         Date iamfs ilaxs</span></span>
<span><span class="co">## 1 2000-11-01   179   230</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $bou99t1</span></span>
<span><span class="co">##         Date iamfs ilaxs</span></span>
<span><span class="co">## 1 1999-11-05   187   233</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $bou99t3</span></span>
<span><span class="co">##         Date iamfs ilaxs</span></span>
<span><span class="co">## 1 1999-11-05   187   232</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $`lu96iN+`</span></span>
<span><span class="co">##         Date iamfs ilaxs</span></span>
<span><span class="co">## 1 1996-10-16   177   232</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $lu96iN6</span></span>
<span><span class="co">##         Date iamfs ilaxs</span></span>
<span><span class="co">## 1 1996-10-16   176   235</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $`lu97iN+`</span></span>
<span><span class="co">##         Date iamfs ilaxs</span></span>
<span><span class="co">## 1 1997-10-10   178   231</span></span></code></pre>
<p>The 8 situations are called here <code>bo96iN+</code>,
<code>bou00t1</code>, <code>bou00t3</code>, <code>bou99t1</code>,
<code>bou99t3</code>, <code>lu96iN+</code>, <code>lu96iN6</code> and
<code>lu97iN+</code>.</p>
<p>Let’s plot the values of these observations:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">obs_df</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">bind_rows</a></span><span class="op">(</span><span class="va">obs_list</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html" class="external-link">pivot_longer</a></span><span class="op">(</span></span>
<span>  cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"iamfs"</span>, <span class="st">"ilaxs"</span><span class="op">)</span>, names_to <span class="op">=</span> <span class="st">"stage"</span><span class="op">)</span></span>
<span><span class="fu">ggplot</span><span class="op">(</span><span class="va">obs_df</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">stage</span>, y <span class="op">=</span> <span class="va">value</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu">geom_boxplot</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="AgMIP_Calibration_Phenology_protocol_files/figure-html/unnamed-chunk-5-1.png" width="700"></p>
<p>The “end juvenile” stage occurred around day 180 after sowing, while
the “maximum LAI” stage occurred around day 230 after sowing.</p>
</div>
<div class="section level2">
<h2 id="setting-information-on-the-parameters-to-estimate">Setting information on the parameters to estimate<a class="anchor" aria-label="anchor" href="#setting-information-on-the-parameters-to-estimate"></a>
</h2>
<p>The whole list of parameters to estimate and their lower and upper
bounds (noted resp. <code>lb</code> and <code>ub</code>) must be
provided in the <code>param_info</code> argument of the
<code>estim_param</code> function.</p>
<p>In this example, we will consider 5 parameters of the STICS crop
model: <code>stlevamf</code>, <code>stamflax</code>, <code>tdmin</code>,
<code>stressdev</code> and <code>tdmax</code>.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">param_info</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  lb <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>stlevamf <span class="op">=</span> <span class="fl">100</span>, stamflax <span class="op">=</span> <span class="fl">300</span>, tdmin <span class="op">=</span> <span class="fl">4</span>, stressdev <span class="op">=</span> <span class="fl">0</span>, tdmax <span class="op">=</span> <span class="fl">25</span><span class="op">)</span>,</span>
<span>  ub <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>stlevamf <span class="op">=</span> <span class="fl">500</span>, stamflax <span class="op">=</span> <span class="fl">800</span>, tdmin <span class="op">=</span> <span class="fl">8</span>, stressdev <span class="op">=</span> <span class="fl">1</span>, tdmax <span class="op">=</span> <span class="fl">32</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p>Note that <code>-Inf</code> or <code>Ìnf</code> can be used for,
respectively, lower and upper bounds. In that case, initial values must
be provided for the corresponding parameters (see
<code><a href="../reference/estim_param.html">? estim_param</a></code> for more details).</p>
<p>The list of candidate parameters must be provided in the
<code>candidate_param</code> argument of<br>
the <code>estim_param</code> function. Note that, as prescribed in the
AgMIP protocol, this list must be ordered, from those thought to be the
most important to those thought to be the least important.</p>
<p>In this example, 3 parameters were considered as candidates.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">candidate_param</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"tdmin"</span>, <span class="st">"stressdev"</span>, <span class="st">"tdmax"</span><span class="op">)</span></span></code></pre></div>
<p>The parameters not included in <code>candidate_param</code> but
included in <code>param_info</code> will be considered as the nearly
additive parameters, as defined in the protocol. In this example,
<code>stlevamf</code> and <code>stamflax</code> are thus the nearly
additive parameters that will be estimated at any step.</p>
</div>
<div class="section level2">
<h2 id="choosing-the-default-parameters-values">Choosing the default parameters values<a class="anchor" aria-label="anchor" href="#choosing-the-default-parameters-values"></a>
</h2>
<p>Default values for the non-estimated parameters and for the candidate
parameters can be defined in the <code>forced_param_values</code>
argument of the <code>estim_param</code> function.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">forced_param_values</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>tdmin <span class="op">=</span> <span class="fl">5.0</span>, stressdev <span class="op">=</span> <span class="fl">0.2</span>, tdmax <span class="op">=</span> <span class="fl">30.0</span><span class="op">)</span></span></code></pre></div>
<p>These values will be used at each step for which these parameters are
not estimated.</p>
</div>
<div class="section level2">
<h2 id="setting-optimization-options">Setting optimization options<a class="anchor" aria-label="anchor" href="#setting-optimization-options"></a>
</h2>
<p>Following the AgMIP phase III protocol, different numbers of
repetition of the minimization are prescribed: 10 for the estimation of
the nearly additive parameters and 5 for the estimation of the candidate
parameters.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">optim_options</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>nb_rep <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">10</span>, <span class="fl">5</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="running-the-optimization">Running the optimization<a class="anchor" aria-label="anchor" href="#running-the-optimization"></a>
</h2>
<p>A simple call to the <code>estim_param</code> function allows running
the whole parameter selection and minimization procedure defined in the
AgMIP phase III protocol.</p>
<p>Compared to the simple example presented in <a href="https://SticsRPacks.github.io/CroptimizR/articles/Parameter_estimation_simple_case.html" class="external-link uri">https://SticsRPacks.github.io/CroptimizR/articles/Parameter_estimation_simple_case.html</a>,
it is important here to define the <code>crit_function</code> argument
of the <code>estim_param</code> function. Indeed, the objective function
to minimize in AgMIP phase III protocol is the Ordinary Least Squares,
implemented in the function <code>crit_ols</code>, which is not the
default criterion in <code>estim_param</code>.</p>
<p>Note also the use of the arguments <code>forced_param_values</code>
and <code>candidate_param</code>.</p>
<p>By default, the information criterion used for the parameter
selection is the BIC, as advised by <a href="https://www.biorxiv.org/content/10.1101/2022.06.08.495355v1" class="external-link">Wallach
et al (2022)</a>. Note, however, that other criteria can be used (AIC
and AICc) using the <code>info_crit_func</code> argument.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">res</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/estim_param.html">estim_param</a></span><span class="op">(</span>obs_list <span class="op">=</span> <span class="va">obs_list</span>,</span>
<span>                crit_function <span class="op">=</span> <span class="va">crit_ols</span>,</span>
<span>                model_function <span class="op">=</span> <span class="va">model_wrapper</span>,</span>
<span>                model_options <span class="op">=</span> <span class="va">model_options</span>,</span>
<span>                optim_options <span class="op">=</span> <span class="va">optim_options</span>,</span>
<span>                forced_param_values <span class="op">=</span> <span class="va">forced_param_values</span>,</span>
<span>                candidate_param <span class="op">=</span> <span class="va">candidate_param</span>,</span>
<span>                param_info <span class="op">=</span> <span class="va">param_info</span><span class="op">)</span></span></code></pre></div>
<p>At the end of the execution, some information such as the selected
step number, the list of selected parameters, their estimated values and
some stats about the execution time are printed in the R console:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">...</span></span>
<span><span class="co"># ----------------------</span></span>
<span><span class="co"># End of parameter selection process</span></span>
<span><span class="co"># ----------------------</span></span>
<span><span class="co">#</span></span>
<span><span class="co"># Selected step: 2</span></span>
<span><span class="co"># Selected parameters: stlevamf,stamflax,tdmin</span></span>
<span><span class="co"># Estimated value for stlevamf :  321.18</span></span>
<span><span class="co"># Estimated value for stamflax :  589.73</span></span>
<span><span class="co"># Estimated value for tdmin :  7.96</span></span>
<span><span class="co">#</span></span>
<span><span class="co"># A table summarizing the results obtained at the different steps  is stored in  C:/Users/sbuis/AppData/Local/Temp/RtmpwRzZkP/data-master/study_case_1/V9.0/param_selection_steps.csv</span></span>
<span><span class="co"># Graphs and detailed results obtained for the different steps can be  found in  C:/Users/sbuis/AppData/Local/Temp/RtmpwRzZkP/data-master/study_case_1/V9.0/results_all_steps/step_# folders.</span></span>
<span><span class="co">#</span></span>
<span><span class="co"># Average time for the model to simulate all required situations: 4.1 sec elapsed</span></span>
<span><span class="co"># Total number of criterion evaluation: 806</span></span>
<span><span class="co"># Total time of model simulations: 3293 sec elapsed</span></span>
<span><span class="co"># Total time of parameter estimation process: 3314 sec elapsed</span></span>
<span><span class="co"># ----------------------</span></span></code></pre></div>
<p>The list returned by the <code>estim_param</code> function contains
the results obtained for the selected step and a data.frame, called
<code>param_selection_steps</code>, providing detailed results of the
protocol. The element <code>param_selection_steps</code> gives, for each
minimization step, the list of candidate parameters, their initial and
final values and the values of the Sum of Squares and information
criteria. The selected step is indicated in the last column. It is also
stored in csv format for sake of readability (file
“param_selection_steps.csv” in <code><a href="https://rdrr.io/r/base/getwd.html" class="external-link">getwd()</a></code> folder or in
<code>optim_options$out_dir</code> folder, if provided to
<code>estim_param</code>).</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.csv</a></span><span class="op">(</span><span class="st">"ResultsAgmipPhenology/param_selection_steps.csv"</span>, sep <span class="op">=</span> <span class="st">";"</span><span class="op">)</span></span>
<span><span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span></span></code></pre></div>
<table style="width:100%;" class="table">
<colgroup>
<col width="23%">
<col width="16%">
<col width="16%">
<col width="16%">
<col width="15%">
<col width="3%">
<col width="7%">
</colgroup>
<thead><tr class="header">
<th align="left">Estimated.parameters</th>
<th align="left">Initial.parameter.values</th>
<th align="left">Final.values</th>
<th align="right">Initial.Sum.of.squared.errors</th>
<th align="right">Final.Sum.of.squared.errors</th>
<th align="right">BIC</th>
<th align="left">Selected.step</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">stlevamf, stamflax</td>
<td align="left">356.22, 522.43</td>
<td align="left">404.58, 739.23</td>
<td align="right">2960</td>
<td align="right">147</td>
<td align="right">41.03</td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left">stlevamf, stamflax, tdmin</td>
<td align="left">404.58, 739.23, 7.67</td>
<td align="left">321.18, 589.73, 7.96</td>
<td align="right">4242</td>
<td align="right">91</td>
<td align="right">36.13</td>
<td align="left">X</td>
</tr>
<tr class="odd">
<td align="left">stlevamf , stamflax , tdmin , stressdev</td>
<td align="left">321.18, 589.73, 7.96, 1.00</td>
<td align="left">321.18, 589.73, 7.96, 1.00</td>
<td align="right">91</td>
<td align="right">91</td>
<td align="right">38.90</td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left">stlevamf, stamflax, tdmin , tdmax</td>
<td align="left">321.18, 589.73, 7.96, 30.20</td>
<td align="left">321.18, 589.73, 7.96, 31.07</td>
<td align="right">91</td>
<td align="right">91</td>
<td align="right">38.90</td>
<td align="left"></td>
</tr>
</tbody>
</table>
<p>In this example, the selected parameters are “stlevamf”, “stamflax”
and “tdmin” for which the lowest value of BIC has been obtained.</p>
<p>The list returned by the <code>estim_param</code> function is also
stored in a file (“optim_results.Rdata”).</p>
<p>The standard results and diagnostics plots generated by
<code>estim_param</code> for all the different steps are stored in the
subfolder “results_all_steps”.</p>
</div>
<div class="section level2">
<h2 id="generating-diagnostics-using-croplotr">Generating diagnostics using CroPlotR<a class="anchor" aria-label="anchor" href="#generating-diagnostics-using-croplotr"></a>
</h2>
<p>First the model wrapper has to be run using the estimated values of
the selected parameters, and the default values for the others, using
its <code>param_values</code> argument.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">param_values</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">res</span><span class="op">$</span><span class="va">final_values</span>, <span class="va">res</span><span class="op">$</span><span class="va">forced_param_values</span><span class="op">)</span></span>
<span><span class="va">sim_after_optim</span> <span class="op">&lt;-</span> <span class="fu">model_wrapper</span><span class="op">(</span>param_values <span class="op">=</span> <span class="va">param_values</span>,</span>
<span>                              model_options <span class="op">=</span> <span class="va">model_options</span>,</span>
<span>                              var <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"iamfs"</span>, <span class="st">"ilaxs"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Then, the simulated versus observed values can be plotted using the
CroPlotR plot function:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">sim_after_optim</span><span class="op">$</span><span class="va">sim_list</span>, obs <span class="op">=</span> <span class="va">obs_list</span>, type <span class="op">=</span> <span class="st">"scatter"</span><span class="op">)</span></span></code></pre></div>
<p><img src="ResultsAgmipPhenology/all_situations.png" width="60%"></p>
<p>MSE and its components can be calcuted for each variable using the
CroPlotR summary function:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">sim_after_optim</span><span class="op">$</span><span class="va">sim_list</span>, obs <span class="op">=</span> <span class="va">obs_list</span>,</span>
<span>        stats <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"MSE"</span>, <span class="st">"Bias2"</span>, <span class="st">"SDSD"</span>, <span class="st">"LCS"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 2 × 7</span></span></span>
<span><span class="co">##   group     situation      variable   MSE  Bias2   SDSD   LCS</span></span>
<span><span class="co">##   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">1</span> Version_1 all_situations iamfs     4.38 0.015<span style="text-decoration: underline;">6</span> 0.063<span style="text-decoration: underline;">7</span>  4.92</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">2</span> Version_1 all_situations ilaxs     7    0.062<span style="text-decoration: underline;">5</span> 1.14    6.78</span></span></code></pre>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Samuel Buis, Patrice Lecharpentier, Remi Vezy, Michel Giner.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
